\chapter{Simulaèní a podpùrnı software}

Po pøedchozím uvedení modelù nastává otázka dalšího postupu. Nabízí se následující monosti:
\begin{itemize}
	\item pokraèovat v~aplikaci, kterou autor vytvoøil pro svoji bakaláøskou práci,
	\item vyuití softwaru AIMSUN,
	\item otevøenı simulaèní software SUMO.
\end{itemize}

Po vyhodnocení všech hledisek se autor rozhodl zvolit platformu softwaru SUMO. Autor si je vìdom toho, e software SUMO je pouze podpùrnım nástrojem pro jeho práci, nicménì pro pochopení nìkterıch dílèích problémù, které jsou zde øešeny, je nutné zde vysvìtlit proto i nìkteré èinnosti vlastního fungování tohoto softwaru.

\begin{comment}
Po prostudování modelù byla otázka dalšího postupu. Bylo moné pokraèovat v~aplikaci, kterou autor vytvoøil pro svoji bakaláøskou práci. další variantou bylo vyuít softwaru AIMSUN, kterı by byl také vhodnı pro naprogramování vlastních modelù. Nicménì zvítìzil otevøenı simulaèní software SUMO. Tento produkt se neustále vyvíjí ji od roku 2001 a jeho podpora neustále pokraèuje. \rem{tato vìta je opravdu bla bla bla} Nejprve se autor pokusil zaèít pracovat v~AIMSUNu, nicménì to skonèilo neúspìšnì, protoe pro naprogramování dalších modelù do tohoto software byl potøeba balíèek, kterı nebyl zdarma.

Další variantou bylo pokraèovat v~programovacím jazyku JAVA na vytvoøené aplikaci pro bakaláøskou práci, nicménì po prozkoumání dalších variant se autor rozhodl, e bude vıhodnìjší pokraèovat s~ji vyvíjenım softwarem SUMO.
\end{comment}

V~této kapitole rozebereme simulaèní software SUMO\footnote{Simulation of Urban MObility} a další, a ji autorem naprogramované èi volnì dostupné nástroje, z~nich bude patrné, proè autor vybral právì tento postup.

\section{SUMO}
\label{sec:SUMO}
SUMO je otevøenı nástroj pro dopravní simulace vyvíjenı centrem DLR\footnote{Deutsches Zentrum für Luft- und Raumfahrt - Nìmecké støedisko pro letectví a kosmonautiku} v oddìlení Institutu pro dopravní systémy v Nìmecku. Ve vızkumu se dá SUMO vyuít v~mnoha oblastech, napø. vyhledání nejkratší cesty\footnote{èi jiného kritéria}, monost zkoušení signálních plánù nebo simulace komunikace mezi vozidly. SUMO bylo a je vyuíváno na mnoha zajímavıch projektech\footnote{napø. pøedpovìï dopravních proudù v~dobì Mistrovství svìta ve fotbale v~Nìmecku v~roce 2006 v~Kolínì nad Rınem, vyuití komunitou V2X pro zjišování dráhy vozidla atd.}.

Od roku 2001 se SUMO postupnì rozšiøovalo a nyní je z~nìj ji soubor nìkolika programù. Umoòuje na základì dopravních mìøení a O/D matic vyuívat rùzné routovací algoritmy, simulování køiovatek. Obsahuje také rozhraní TraCI pro online simulaci.

Existují nìkteré další volnì dostupné simulaèní softwary, které se však dále nerozvíjely a pøestaly bıt døíve èi pozdìji podporovány. Toto je u SUMO vysoce nepravdìpodobné z dùvodu vıvoje v rámci DLR.

Pøi vıvoji SUMO existovaly dva hlavní dùvody, proè by mìl bıt otevøenım softwarem. První z~nich je snaha podporovat spoleèenství, které se zabıvá simulacemi, volnì dostupnım nástrojem, ve kterém ji budou zahrnuty základní algoritmy. Druhım dùvodem je fakt, e pro dopravní simulace neexistuje na trhu nástroj, jen by umonil jednoduše porovnávat rùzné dopravní modely (a u jde o modely sledu vozidel, pøedjí\-dìcí modely, èi øízení dopravy).

Tento druhı dùvod a také monost vlastní implementace modelù vedly autora k~volbì SUMO. K~tomu, aby bylo moné vlastní modely vùbec implementovat, bylo tøeba pouít vıvojovou verzi simulátoru. To znamená, e nestaèí pouze verze SUMO, které obsahuje spustitelné soubory, ale potøebujeme pøímo zdrojové kódy. Více o~tom, jak SUMO zkompilovat, je uvedeno v~pøíloze \ref{kompilaceSUMO}.

\subsection{Jak to funguje}

Po zjištìní, èeho všeho je SUMO pøiblinì schopno, je k~tomu, aby byla spuštìna simulace, mít zapotøebí pøipraveny minimálnì tøi typy souborù, a to:
\begin{itemize}
	\item konfiguraèní soubor,
	\item soubor s~podkladem (dopravní sí),
	\item soubor s~vozidly,
	\item další soubory.
\end{itemize}

\subsection{Konfiguraèní soubor}
V~konfiguraèním souboru je moné nastavit všechny monosti, které se bez tohoto souboru musí zapsat pøi spuštìní SUMO jako parametry pøíkazové øádky. To lze vyuít, kdy se SUMO spouští s~mnoha parametry.

\subsection{Soubor s~podkladem}
\label{sub:podkladSUMO}
Pro diplomovou práci obdrel autor data, a to konkrétnì intenzity a prùmìrné rychlosti z~mıtnıch bran Silnièního okruhu kolem Prahy (SOKP, Praského okruhu). Bylo proto vhodné mít jako podklad pro simulaci sí v~konkrétních úsecích mezi mıtnımi branami. Pro mapu oblasti bylo vyuito volnì dostupnıch map ze serveru OpenStreetMap, kde byl konkrétní úsek staen ve formátu OSM a byly smazány všechny prvky nesouvisející s~Praskım okruhem. Posléze byl pouit jeden z~nástrojù SUMO, a to konkrétnì \emph{Netconvert}, kterı pøevádí data z~pøedem definovaného formátu do SUMO formátu. Více k~tomuto tématu v~pøíloze \ref{chap:netSUMO}.

SUMO navíc také umoòuje vyuít vlastní nástroj na generování sítí, \emph{JTRrouter} èi \emph{DFrouter}.

\subsection{Vozidla pro simulaci}
\label{subsec:vehforsim}
Vozidla mají v~SUMO nìkolik parametrù. Mezi základní patøí
\begin{itemize}
	\item id vozidla,
	\item typ vozidla,
	\item dráha, po které se bude vozidlo pohybovat,
	\item èas vjezdu do oblasti,
	\item místo vjezdu do oblasti,
	\item rychlost pøi vjezdu do oblasti,
	\item jízdní pruh pøi vjezdu do oblasti.
\end{itemize}

Mùeme tedy na zaèátku definovat typ vozidla, co znamená jeho parametry jako napø. délka vozidla, zrychlení, max. rychlost atp. Poté u~kadého vozidla nastavíme tento typ a vozidlo automaticky dostane všechny pøiøazené parametry.

Dráha, po které se bude vozidlo pohybovat, souvisí s~podkapitolou \ref{sub:podkladSUMO}, kde pøímo tyto jízdní úseky vytváøíme. Tento parametr mùe obsahovat více hodnot (napø. jednotlivé úseky, po kterıch se dané vozidlo bude pohybovat), v~pøípadì Praského okruhu minimálnì èást mezi dvìma mıtnımi branami.

\subsection{Další soubory}
\label{subsec:additionalfiles}

Další soubor, kterı vytvoøíme, se tıká informací o~indukèních smyèkách. Definujeme zde název vıstupního souboru z daty, jejich polohu a èasovı úsek, ve kterém má probìhnout sbìr dat. Po probìhnutí simulace budou data z tìchto smyèek uloena do souboru ve sloce, ze které  spouštíme simulaci. Indukèní smyèka dokáe získat informaci o poètu vozidel za urèenı èasovı úsek, jejich prùmìrné rychlosti, obsazenosti a dalších parametrù. V našem pøípadì nastavíme èasovı úsek sbìru dat stejnı jako v reálnıch datech, tzn. 1~minuta.

\section{Pøíprava a vyhodnocení simulace -- program}
\label{sec:program}
Aby bylo moné dostat se k~jádru celé práce, je nutná pøíprava dat pro simulaci a také jejich následné vyhodnocení. K~tomuto úèelu byla v jazyce JAVA vytvoøena konzolová aplikace jménem \textit{AllInOne.jar}. Pro její správnou funkènost je nutné mít nainstalované rozhraní pro Java aplikace (JRE).

Aplikace umoòuje tøi základní operace:
\begin{enumerate}
	\item pøevedení formátu dat (MATLAB) z~Praského okruhu na formát podporovanı softwarem SUMO (XML),
	\item vytvoøení souboru vozidel pro simulaci (viz podkapitola \ref{subsec:vehforsim}), nebo SUMO nemá vlastní generátor vozidel,
	\item vytvoøení vıstupù ze simulace (viz dále).
\end{enumerate}

Dùvodem pro volbu jazyka JAVA bylo jednak to, e autor s tímto jazykem dokáe pohodlnì pracovat (na rozdíl od jazyka Python, jen je standardním rozšiøovacím jazykem simulátoru) a také existence volnì dostupného balíèku pro monost práce s~daty ze softwaru MATLAB \cite{Jmatio}. Dále se autor rozhodl, e vytvoøí radìji jednu pøehlednou aplikaci, ne 5 malıch.

\subsection{Tøída AllInOne}

Tøída AllInOne obsahuje dìlení programu na jednotlivé podèásti. Ty pak vykonají pøíslušnou úlohu.

V~hlavní tøídì se nachází konstruktor, kterı na základì vstupních parametrù vytvoøí objekt pøíslusné tøídy, pøípadnì vytiskne chybovou hlášku s~problémem.

\begin{comment}
Dále je zde funkce na zjištìní, zda zadanı parametr je èíslo.

\begin{itemize}
	\item \textit{public AllInOne(String args[])} -- konstruktor, vìtvení na základì vstupního pole \textit{args}
	\item \textit{public static boolean isInteger(String s)} -- funkce na kontrolu, zda je vstupní øetìzec \textit{s} èíslo
\end{itemize}
\end{comment}

\subsection{Pøevedení formátu dat - tøída MatlabToXML}
\label{subsec:convert}
Nejprve je nutné data Praského okruhu pøevést do stejného formátu, kterı nám potom budou dávat indukèní smyèky. Naprogramovaná tøída, která toto v~Javì umí, je nazvána \textit{MatlabToXML}. V~konstruktoru se vytvoøí soubor, jeho název je jeden ze vstupních parametrù a poté ve funkci \textit{createLoopDocument} se pøímo vytváøí jeho obsah.

\begin{itemize}
	\item \textit{public MatlabToXML(String fileNameMatlab, String fileNameCars)} -- první vstup\-ní parametr urèuje soubor ve formátu .mat, kterı má pøedem definovanou strukturu, která je shodná s~mıtnımi branami z~Praského okruhu. Vıstupní soubory se potom budou jmenovat na základì vstupní promìnné \textit{fileNameCars}, kde dále bude následovat potrítko a èíslo pruhu\footnote{Napø. pro vstupní parametr detektorkm0201.xml, budou vıstupní soubory \texttt{detektorkm0201\_0.xml} a \texttt{detektorkm0201\_1.xml}}, ve kterém budou informace o~rychlostech a intenzitách pouze pro ten danı pruh.
	\item \textit{public Document createLoopDocument(int lane)} -- vstupní parametr \textit{lane} urèuje pruh, pro kterı se právì obsah souboru vytváøí.
\end{itemize}

Vıstupní soubor bude shodnı s~vıstupním souborem po simulaci SUMO, take bude moné pøesnì jednotlivé hodnoty z~mıtnıch bran porovnat s~nasimulovanımi.

Pøíkaz, kterım lze program spustit, aby vytvoøil tento dokument, je následující

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -m sokp-0187-20121031.mat det0187.xml
\end{lstlisting}

Ze souboru \texttt{sokp-0187-20121031.mat} vytvoøí v~závislosti na poètu pruhù pod touto mıtnou branou stejnı poèet souborù, tedy \texttt{det0187\_0.xml}, \texttt{det0187\_1.xml} atd.

Tyto soubory lze následnì pouít jako vstup pro vytvoøení souboru s~informacemi o~vjezdech vozidel pro SUMO, anebo pro vytvoøení grafù nebo histogramù pro porovnání vısledkù se simulací.

\subsection{Vytvoøení souboru vozidel pro simulaci - tøída XMLCreator}
\label{subsec:vozidla}
Pro simulaci v SUMO je moné vytvoøit si ruènì jakıkoliv soubor vozidel. SUMO obsahuje pøímo manuál, jak tento soubor vytvoøit \cite{SUMOWiki}. Není ovšem vhodné vytváøet ho ruènì, nıbr pouít nìjakı nástroj pro XML.

Další funkcí, kterou tedy aplikace disponuje, je vytvoøení souboru s informací o vjídìjících vozidlech pro simulaci. Tento soubor je plnì kompatibilní se vstupními soubory pro SUMO. Vstupním souborem pro generování vozidel bude opìt soubor s~pøíponou \texttt{.mat}, vıstupním soubourem potom jeden soubor obsahující za sebou seøazená vozidla dle vjezdu do oblasti s~rychlostí vygenerovanou z~Gaussova rozdìlení. Další parametry jsou pøedem dané èi generované v~aplikaci a urèují se na základì volby modelu, kterı lze nastavit z~pøíkazové øádky. Kadému vozidlu je toti nutné pøiøadit model sledu vozidel, podle kterého se má v simulaci pohybovat.

Jedinı problém nastává ve chvíli, kdy musíme jednotlivım vozidlùm nastavit jejich cestu v~simulaci. Pokud všechna vozidla pojedou po stejné dráze, staèí, kdy se kadému vozidlu pøiøadí cesta, která je shodná s~názvy hran podkladu (viz podkapitola \ref{sub:podkladSUMO} a \ref{sec:OSM} poslední odstavec).

Pro naší simulaci cestu pro vozidlo pøedem pøipravíme tak, aby všechna vozidla projela úsekem, kterı chceme simulovat. V~konzolové aplikaci v~tomto smìru není nutné nic dalšího nastavovat.

Tøída \emph{XMLCreator} obsahuje následující konstruktor a metody:

\begin{itemize}
	\item \textit{public XMLCreator(String fileNameMatlab, String fileNameCars, String model, String type)} -- konstruktor, kterı pøijímá název datového souboru, ze kterého budeme vozidla generovat, název vıstupního souboru a zpùsob generování èasu vstupu vozidla do oblasti,
	\item \textit{public Document createRouteEqualDocument(String model)} -- naplnìní souboru pøi konstantní èasové vzdálenosti vozidel,
	\item \textit{public Document createRouteExpDocument(String model)}  -- naplnìní souboru pøi generování vozidel z~exponenciálního rozdìlení,
	\item \textit{public Element createVType(Element element, int actualCar, String model, int iTime, int lane)} -- vytvoøení parametrù pro konkrétní vozidlo \textit{actualCar}, nastavení pruhu \textit{lane} a èasu \textit{iTime}, ve kterém vjídí do simulace v~závislosti na modelu \textit{model},
	\item \textit{public Element createVehicle(Element element, int actualCar, double time, int iTime, int lane, String type)} -- vytvoøení jednoho exempláøe vozidla s~pøíslušnımi parametry, \textit{actualCar} je poøadí vozidla od zaèátku simulace, \textit{lane} pruh do kterého bude vozidlo vygenerováno, \textit{time} je èas ve kterém vozidlo bude vpuštìno do simulace.
\end{itemize}

Lze pøidat konkrétní model, tøetí parametr pøíkazu, podle kterého chceme aby SUMO simulovalo provoz. Tento parametr je nepovinnı a pokud ho nezadáme, program pøedpo\-kládá volbu Kraussova modelu.

Základními parametry jsou:
\begin{itemize}
	\item zrychlení $a$,
	\item decelerace $b$,
	\item reakèní èas øidièe $T$.
\end{itemize}

Ty je zatím moné nastavit pouze ve zdrojovém kódu programu.

Zatím jsou k~dispozici ètyøi modely a k~nim pøíslušné parametry:
\begin{itemize}
	\item Gippsùv model tak, jak je popsán v sekci \ref{sec:Gipps}:
	\begin{itemize}
		\item desiredSpeed ($V_\n$): preferovaná rychlost daného vozidla, rychlost je generovaná z~normálního rozdìlení se støední hodnotou 130\,km/h, co je maximální rychlost na rychlostní komunikaci a smìrodatnou odchylkou 10\% z maximální rychlosti, která byla stanovena na základì expertního odhad.
			\end{itemize}
\end{itemize}

\begin{lstlisting}[breaklines=true]
	java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml Gipps
\end{lstlisting}

\begin{itemize}
	\item Kraussùv model a Rozšíøenı Kraussùv model, tak jak je popsán v sekci \ref{sec:Krauss}, resp. \ref{exKrauss}:
	\begin{itemize}
		\item $\eta$: náhodná vıchylka od bìného øízení, hodnota 0,5 - pøedem nastavena v rámci SUMO.
	\end{itemize}
\end{itemize}

\begin{lstlisting}[breaklines=true]
	java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml Krauss
\end{lstlisting}
\begin{lstlisting}[breaklines=true]
	java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml KraussOrig
\end{lstlisting}

\begin{itemize}
	\item IDM, Intelligent Driver Model ze sekce \ref{sec:IDM}
	\begin{itemize}
		\item delta ($\delta$): exponent akcelerace dle rovnice \eqref{zrychvolproud} - hodnota 4, doporuèena v rámci kalibrování autorù IDM \cite{Treiber}.
	\end{itemize}
\end{itemize}

\begin{lstlisting}[breaklines=true]
	java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml IDM
\end{lstlisting}

\begin{itemize}
	\item Wiedemannùv model - parametry pouity pro vıpoèet køivek AX, BX atd. z obrázku \ref{wiedemann}
	\begin{itemize}
		\item estimation - hodnota 0,5,
		\item security - hodnota 0,5.
	\end{itemize}
\end{itemize}

Vıslednı soubor bude mít název \texttt{vozidla.rou.xm}l -- \texttt{.rou} je povinná druhá pøípona, která pokud není uvedena, SUMO nespustí simulaci.

Implicitnì je vıchozí generování vozidel deterministické. Pokud nám v~jedné minutì projede napø. 10 vozidel, tak vozidla budou mít vstupní èas rovnomìrnì rozdìlen po 1/10. Tato varianta se zde nachází proto, aby bylo moné zkontrolovat správné generování vozidel a chování jednotlivıch modelù sledu vozidel. Vıslednı pøíkaz tedy bude:

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml Gipps
\end{lstlisting}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{images/poisson67.pdf} & \includegraphics[width=0.45\textwidth]{images/poisson1518.pdf}  \\
		a) Èas 6:00 -- 7:00 & b) Èas 15:00 -- 18:00
	\end{tabular}
		\caption{Èetnosti vozidel -- 28.10.2012}
\label{poissoncetnosti}
\end{figure}

Další varianta vyuívá znalost, e pokud rozdìlení poètu vozidel za nìjakı èas je Poissonovo, potom odstupy mezi vozidly mají exponenciální rozdìlení. Z~pohledu na obrázek \ref{poissoncetnosti}\footnote{vytvoøen také tímto programem} lze pøedpokládat, e se opravdu jedná o~Poissonovo rozdìlení. Pro kontrolu byl ještì proveden test, zda se jedná o Poissonovo rozdìlení, kterı je uveden v pøíloze \ref{chap:chi2test}.

Pokud chceme, aby se nám vozidla generovala z~exponenciálního rozdìlení, kde se kadou minutu bude mìnit jeho parametr $\lambda$ ( v~závislosti na poètu vjídìjících vozidel za minutu), zvolíme monost spuštìní s~dodateènım parametrem exp:

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml Krauss exp
\end{lstlisting}

Pokud vynecháme oznaèení modelu sledu vozidel, bude aplikace implicitnì uvaovat standardní Kraussùv model. Aplikace AllInOne.jar, zavolaná jako

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml Gipps
\end{lstlisting}
generuje vozidla, která se budou pohybovat dle Gippsova modelu a budou mít deterministickı èasovı odstup. Je moné vynechat i model, tzn.

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml exp
\end{lstlisting}
generuje vozidla z~exponenciálního rozdìlení. Pohyb bude na základì Kraussova modelu.

Soubor \texttt{vozidla.rou.xml} lze rovnou pouít jako vstupní soubor vozidel pro simulaci v~SUMO.

\subsection{Vıstupy ze simulací}

Po simulaci SUMO vytvoøí nìkolik souborù. Hlavní soubor v XML formátu, jeho název urèujeme pøi spouštìní simulace, obsahuje informace o~vozidlech, která se nacházejí v~simulaci kadou sekundu. Pro naše vıstupy budou ovšem nejdùleitìjší soubory, dávající data z indukèních smyèek (viz \ref{subsec:additionalfiles}). Tento soubor se bude zpracovávat stejnì jako soubor vzniklı pomocí aplikace \textit{AllInOne} uvedeného v~odstavci \ref{subsec:convert}.

Pro porovnání reálnıch a nasimulovanıch dat nabízí aplikace \textit{AllInOne.jar} tøi mo\-nosti vyhodnocení:
\begin{itemize}
	\item èasová øada poètu vozidel kadou minutu,
	\item poèet vozidel za èasovı úsek, jeho délku je moné nastavit,
	\item histogram èetností vozidel; v tomto pøípadì máme monost nastavit nastavení èasového intervalu, ve kterém nás èetnosti zajímají.
\end{itemize}

\subsection{Èasová øada -- tøída XMLReader}
\label{subsec:xmlread}
Jednou z~moností, jak zobrazit vıstupy ze simulace, je pomocí èasové øady. Program vyhodnotí všechny vstupní soubory a pøedpøipraví soubor \texttt{gnuplot.txt}, pomocí kterého je potom moné vykreslit tuto øadu za pomoci programu pro vykreslování grafù GNUplot \cite{GNUplot}. Program vytvoøí tento soubor pro kadı pruh zvlášt a poté souhrnı soubor, kterı obsahuje kadı pruh a souèet vozidel v~jednom grafu.

Tøída \emph{XMLReader} obsahuje následující konstruktor a metody:
\begin{itemize}
	\item \textit{public XMLReader(String fileNameInput, String fileNameOutput) throws DocumentException} - první parametr je vstupní soubor ve formátu XML (buïto vytvoøenı programem z~Matlab souboru nebo ze simulace SUMO), druhı parametr je potom název souboru, kterı je pøi instalovaném GNU\-plotu vygenerován automaticky,
	\item \textit{public static void timeSeries(String fileNameInput,String fileNameOutput,int numberOfFiles) throws DocumentException} -- stejné parametry jako u~konstruktoru + navíc poèet souborù, které je nutné zpracovat,
	\item  \textit{private static Calendar setStart(Calendar cal)} -- nastavení èasové øady od pùlnoci do pùlnoci z dùvodu vìtší pøehlednosti programu,
	\item \textit{public static Document parse(String fileName) throws DocumentException} -- rozdì\-lení XML dokumentu na jednotlivé èásti
\end{itemize}

Je potøeba si uvìdomit, e zadáváme jeden vstupní soubor, ale vstup je vlastnì nìkolik souborù zároveò. Napø. pøíkaz

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -x detektor.xml graf.pdf
\end{lstlisting}
prochází aktuální sloku a kontroluje všechny XML soubory mající tvar \texttt{detektor\_0.xml}, \texttt{detektor\_1.xml} atd. Poté vytvoøí pomocné soubory, které obsahují sadu pøíkazù pro vykreslení grafu GNUplotem. Pomocné textové soubory jsou vdy pro kadı pruh dva, a to \texttt{pocetvozidelpruh\_1.txt} a \texttt{gnuplot\_1.txt} pro 1. pruh atd. Hlavní soubor, kde jsou obsaeny všechny pruhy, má název \texttt{gnuplot.txt} a ke svému spuštìní potøebuje \texttt{pocetvozidelpruh.txt}.

\subsection{Poèet vozidel za danı èas -- tøída XMLReaderHist}

Další variantou je vykreslení histogramu poètu vozidel za èas. Je moné vykreslit poèet vozidel za minutu, kde vısledek bude stejnı jako èasová øada s~tím rozdílem, e grafem bude histogram. Program tudí umí nastavit i jinou èasovou délku úseku, napø. poèet vozidel za hodinu.

Tøída \emph{XMLReaderHist} obsahuje následující konstruktor a metody
\begin{itemize}
	\item \textit{public XMLReaderHist(String fileNameInput, String fileNameOutput, String w) throws DocumentException} -- stejná situace jako u~XMLReaderu (viz odstavec \ref{subsec:xmlread}), poslední parametr je potom délka úseku, za kterı chceme poèítat vozidla
	\item \textit{public static void hist(String fileNameInput, String fileNameOutput, int numberOfFiles, String w) throws DocumentException} -- úplnì stejná funkce jako u~XMLReaderu doplnìna o~èasovı interval
\end{itemize}

Všechny další funkce, které tøída obsahuje, ji byly vysvìtleny v~pøedcházejících tøídách.

Pokud chceme histogram poètu vozidel bìhem celého dne, necháme poslední parametr volání prázdnı, tedy

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -xh detektor.xml histogram.pdf
\end{lstlisting}

Další moností je nastavit si délku èasového úseku. Tato délka musí bıt dìlitelná poètem minut dne (1440) a udává se v~minutách. Jinak program argument ignoruje a vytvoøí histogram, jako kdyby ádnı parametr nebyl zadán. Pøíkaz

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -xh detektor.xml histogram.pdf 60
\end{lstlisting}
tedy vytvoøí histogram, kde se sèítají vozidla za hodinu.


\subsection{Histogram - tøída Histogram}

Poslední moností analızy vıstupu je histogram èetností poètu vozidel.\footnote{Obrázek \ref{poissoncetnosti} vznikly právì díky tomuto modulu.} Tento histogram mùeme udìlat jak pro celı den, tak i pro urèitou èasovou oblast (napø. ranní špièka). Pokud nejsou zadány parametry od a do, histogram se vytvoøí pro celı den. Je moné také vytvoøit histogram pøes pùlnoc, tzn. od 22:00 do 3:00.

Tøída Histogram obsahuje následující konstruktor a metody:

\begin{itemize}
	\item \textit{public Histogram(String fileNameInput, String fileNameOutput, String from, String to) throws DocumentException} -- opìt stejné parametry jako v~pøedchozích tøídách, tz. název vstupního a vıstupního souboru, kterı bude vytvoøen po spuštìní GNU\-plotu, a dále èasové hodnoty od kdy a do kdy chceme histogram vykreslit,
	\item \textit{public static void hist(String fileNameInput, String fileNameOutput, int numberOfFiles, String from, String to) throws DocumentException} -- vytvoøení souborù pro GNUplot, všechny parametry jsou stejné jako u~pøedchozích tøíd.	
\end{itemize}
Pokud chceme vytvoøit histogram poètu vozidel za celı den, pøíkaz vypadá následovnì
\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -h detektor.xml histogram.pdf
\end{lstlisting}
Pokud nás zajímá pouze urèitı èasovı úsek, na konec pøíkazu zadáme pøíslušné meze
\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -h detektor.xml histogram.pdf 2:00 5:00
\end{lstlisting}
pro vytvoøení histogramù poètu vozidel od 2 do 5 ráno.

\section{Shrnutí práce s~programem}

Program byl vytvoøen v~jazyce JAVA jako podpùrnı prostøedek pro vytvoøení jak vstupù, tak vıstupù pro program SUMO pøi daném typu vstupních dat z~Praského okruhu. Program se spouští s~pøíkazové øádky pøíkazem

\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar
\end{lstlisting}

a dále zadáním pøíslušnıch parametrù.

Program se dìlí na pìt hlavních èástí a pro kadou z~nich je uveden pøíklad pro spuštìní:

\begin{itemize}
	\item vytvoøení vstupního souboru vozidel pro SUMO
	\begin{itemize}
		\item pravidelné rozloení - napø. IDM model
		\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml IDM
		\end{lstlisting}
		\item z~exponenciálního rozdìlení - Kraussùv model (není nutno uvádìt)
		\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml exp
		\end{lstlisting}
		\item z~exponenciálního rozdìlení - Wiedemannùv model
		\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -c sokp-0201-20121001.mat vozidla.rou.xml Wiedemann exp
		\end{lstlisting}
	\end{itemize}
	\item pøevedení formátu dat z~Matlabu do formátu SUMO
	\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -m sokp-0187-20121031.mat det0187.xml
	\end{lstlisting}
	\item vytvoøení grafu èasové øady
	\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -x detektor.xml graf.pdf
	\end{lstlisting}
	\item vytvoøení histogramu poètu vozidel za èasovı úsek -- v~tomto pøípadì 1 hodina
		\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -xh detektor.xml histogram.pdf 60
		\end{lstlisting}
	\item vytvoøení histogramu èetností vozidel -- v~tomto pøípadì od 2 do 5 hodin ráno
		\begin{lstlisting}[breaklines=true]
java -jar AllInOne.jar -h detektor.xml histogram.pdf 2:00 5:00
		\end{lstlisting}
\end{itemize} 