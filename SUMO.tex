\chapter{Simulaèní a podpùrnı software}

V této kapitole rozebereme simulaèní software SUMO\footnote{Simulation of Urban MObility} a další, a ji naprogramované autorem èi volnì dostupné nástroje.

\section{SUMO}

Po prostudování modelù byla otázka dalšího postupu. Bylo moné pokraèovat v aplikaci, kterou autor vytvoøil pro svoji bakaláøskou práci, další variantou bylo vyuít softwaru AIMSUN, kterı by byl také vhodnı pro naprogramování vlastních modelù. Nicménì zvítìzil open-source simulaèní software SUMO. Tento produkt se neustále vyvíjí ji od roku 2001 a jeho podpora neustále pokraèuje. Nejprve se autor pokusil zaèít pracovat v AIMSUNu, nicménì to skonèilo neúspìšnì, protoe pro naprogramování dalších modelù do tohoto software byl potøeba balíèek, kterı nebyl zdarma.

Další variantou bylo pokraèovat v programovacím jazyku JAVA na vytvoøené aplikaci pro bakaláøskou práci, nicménì po prozkoumání dalších variant se autor rozhodl, e bude vıhodnìjší pokraèovat s ji vyvíjenım softwarem SUMO.

SUMO je open-source nástroj pro dopravní simulace. Ve vızkumu se dá SUMO vyuít v mnoha oblastech napø. vyhledání nejkratší cesty\footnote{èi podle jiného kritéria}, monost zkoušení signálních plánù nebo simulace komunikace mezi vozidly. SUMO bylo a je vyuíváno na mnoha zajímavıch projektech\footnote{napø. pøedpovìï dopravních proudù v dobì MS v Nìmecku v roce 2006 v Kolínì nad Rınem, vyuití komunitou V2X pro zjišování dráhy vozidla atd.}.

Od roku 2001 se SUMO postupnì rozšiøovalo a nyní je z nìj ji soubor nìkolika programù. Umoòuje na základì dopravních mìøení, matic vzdáleností vyuívat rùzné routovací algoritmy, simulování køiovatek. Obsahuje také rozhraní TraCI pro online simulaci.

Pøi vıvoji SUMO byly hlavní dva dùvody proè by mìl bıt opensource. První z nich je snaha podporovat komunitu, která se zabıvá simulacemi, volnì dostupnım nástrojem ve kterém ji budou zahrnuty základní algoritmy. Existují nìkteré další volnì dostupné simulaèní softwary, na kterıch ovšem nepracovali studenti a pøestaly bıt døíve èi pozdìji podporovány. Druhım dùvodem je neexistující porovnatelnost implementovatelnost modelù a algoritmù.

Tento druhı dùvod a také monost vlastní implementace modelù vedly autora k volbì SUMO. K tomu, aby bylo moné vlastní modely vùbec implementovat, bylo nejprve nutné vlastní SUMO zkompilovat, to znamená, e nestaèí pouze verze SUMO, které obsahuje spustitelné soubory, ale pøímo zdrojové kódy. Více o tom jak SUMO zkompilovat se ètenáø dozví v pøíloze \ref{kompilaceSUMO}.

\subsection{Jak to funguje}

Nyní ji víme, èeho všeho je SUMO pøiblinì schopno. K tomu abychom spuštìna simulace je zapotøebí mít pøipraveny minimálnì tøi typy souborù, a to
\begin{itemize}
	\item konfiguraèní soubor,
	\item soubor s podkladem (dopravní sí),
	\item soubor s vozidly.
\end{itemize}

\subsection{Konfiguraèní soubor}
V konfiguraèním souboru je moné nastavit všechny monosti, které obsahuje SUMO jako parametry pøíkazové øádky. To se mùe hodit obzvláš ve chvíli, kdy se SUMO volá s mnoha parametry. Tehdy ho staèí zavolat pouze s konfiguraèním souborem.

\subsection{Soubor s podkladem}
\label{sub:podkladSUMO}
Pro diplomovou práci dostal autor data konkrétnì prùmìrné intenzity a rychlosti z mıtnıch bran Praského okruhu. Bylo proto vhodné mít jako podklad pro simulaci sí v konkrétních úsecích mezi mıtnımi branami. Pro mapu oblasti bylo vyuito volnì dostupnıch map ze serveru OpenStreetMap, kde se konkrétní úsek stáhnul ve formátu OSM a vymazaly se všechny prvky nesouvisející s Praskım okruhem. Posléze byl pouit jeden z nástrojù SUMO a to konkrétnì netconvert, kterı pøevádí data z pøedem definovaného formátu do SUMO formátu. Více k tomuto tématu v pøíloze \ref{chap:netSUMO}.

SUMO také umoòuje vyuít vlastní nástroj na generování sítí, JTRrouter èi DFrouter.

\subsection{Vozidla pro simulaci}

Vozidla mají v SUMO nìkolik parametrù, které mimo jiné závisí také na volbì mikroskopického modelu.  Mezi základní patøí
\begin{itemize}
	\item id vozidla,
	\item typ vozidla,
	\item dráha, po které se bude vozidlo pohybovat,
	\item èas vjezdu do oblasti,
	\item místo vjezdu do oblasti,
	\item rychlost pøi vjezdu do oblasti,
	\item jízdní pruh pøi vjezdu do oblasti.
\end{itemize}

Mùeme na zaèátku definovat typ vozidla, co znamená jeho parametry jako napø. délka vozidla, zrychlení, max. rychlost atp. Poté u kadého vozidla nastavíme tento typ a vozidlo automaticky dostane všechny pøiøazené parametry.

Dráha, po které se bude vozidlo pohybovat, souvisí s odstavcem \ref{sub:podkladSUMO}, kde pøímo tyto jízdní úseky vytváøíme. Tento parametr mùe obsahovat více hodnot, v pøípadì Praského okruhu minimálnì èást mezi dvì mıtnımi branami.

\section{Pøíprava a vyhodnocení simulace - program}

Aby bylo moné dostat se k jádru celé práce, je nutná pøíprava dat pro simulaci a také jejich následné vyhodnocení. K tomuto úèelu byla vytvoøena konzolová aplikace, která umoòuje 4 základní operace
\begin{enumerate}
	\item pøevedení formátu dat (MATLAB) z Praského okruhu na formát podporovanı softwarem SUMO (XML)
	\item vytvoøení moností, jak vytváøet vstupní soubor vozidel
	\item vytvoøení souboru, kterı po následném spuštìní programem gnuplot vytvoøí graf èasové øady
	\item vytvoøení souboru, kterı po následném spuštìní programem gnuplot vytvoøí histogram
\end{enumerate}

Tato aplikace byla vytvoøena v jazyku JAVA z dùvodu nalezení balíèku pro monost práce s daty ze softwaru MATLAB. Dále se autor rozhodl, e vytvoøí radìji jednu pøehlednou aplikaci ne 5 malıch.

\subsection{Tøída AllInOne}

V hlavní tøídì se nachází konstruktor, kterı na základì vstupních parametrù zavolá pøíslušnou tøídu, pøípadnì vytiskne chybovou hlášku s problémem. Dále je zde funkce na zjištìní, zda zadanı parametr je èíslo.

\begin{itemize}
	\item \textit{public AllInOne(String args[])} - konstruktor, vìtvení na základì vstupního pole \textit{args}
	\item \textit{public static boolean isInteger(String s)} - funkce na kontrolu, zda je vstupní øetìzec \textit{s} èíslo
\end{itemize}

\subsection{Pøevedení formátu dat}

Pro SUMO je moné vytvoøit si jakıkoliv soubor vozidel. SUMO obsahuje pøímo manuál, jak tento soubor vytvoøit. Není ovšem vhodné vytváøet ho ruènì, nıbr pouít nìjakı nástroj pro XML.

Tøída, která toto umí v Javì, je nazvána \textit{MatlabToXML}. V konstruktoru se vytvoøí soubor, jeho název je jeden ze vstupních parametrù a poté ve funkci \textit{createLoopDocument} se pøímo vytváøí jeho obsah.

\begin{itemize}
	\item \textit{public MatlabToXML(String fileNameMatlab, String fileNameCars)} - první vstupní parametr urèuje soubor ve formátu .mat, kterı má pøedem definovanou strukturu, která je shodná s mıtnımi branami z Praského okruhu. Vıstupní soubory se potom budou jmenovat na základì vstupní promìnné \textit{fileNameCars}, kde dále bude následovat potrítko a èíslo pruhu\footnote{Napø. pro vstupní parametr detektorkm0201.xml, budou vıstupní soubory detektorkm0201\_0.xml a detektorkm0201\_1.xml}, ve kterém budou informace o rychlostech a intenzitách pouze pro ten danı pruh.
	\item \textit{public Document createLoopDocument(int lane)} - vstupní parametr \textit{lane} urèuje pruh, pro kterı se právì obsah souboru vytváøí.
\end{itemize}

Vıstupní soubor bude shodnı s vıstupním souborem po simulaci SUMO, take bude moné pøesnì jednotlivé hodnoty z mıtnıch bran porovnat s nasimulovanımi.

Pøíkaz, kterım lze program spustit aby vytvoøil tento dokument, je následující

\begin{lstlisting}[breaklines=true]
java -jar out\artifacts\AllInOne_jar\AllInOne.jar -m sokp-0187-20121031.mat det0187.xml
\end{lstlisting}

Ze souboru \textit{sokp-0187-20121031.mat} vytvoøí v závislosti na poètu pruhù pod touto mıtnou branou stejnı poèet souborù, tedy \textit{det0187\_0.xml}, \textit{det0187\_1.xml} atd.

Tyto soubory lze následnì pouít jako vstup pro vytvoøení souboru s vozidly pro SUMO a nebo pro vytvoøení grafù nebo histogramù pro porovnání vısledkù se simulací.