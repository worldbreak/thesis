

\chapter{Mikroskopické modely}
\label{chap:predIDM}

\begin{comment}
Jednoduše øeèeno „Car Following“ modely vycházejí z pøedpokladu, když $n$-té vozidlo následuje ($n-1$)-té vozidlo na homogenní (stejnorodé) dálnici, trajektorie n-tého vozidla bude v podstatì stejná jako ($n-1$) vozidla kromì posunù v èase a místì. (Vozidlo bude ve stejném místì jako pøedcházející v jiný èas a ve stejný èas bude na jiném místì.) Všechna ostatní vymyšlená pravidla (modely) v sobì toto jednoduché a pomìrnì pøesné pravidlo obsahují. Newellùv model je v podstatì speciálním pøípadem ostatních modelù s ménì parametry a jinou logikou. Posloužil také jako základ pro pozdìjší Intelligent Driver Model.
\end{comment}

Hlavní skupinou mikroskopických modelù jsou tzv. \uv{Car Following} modely. Tyto modely vycházejí z pøedpokladu, že pokud n-té vozidlo následuje $n-1$ vozidlo na homogenní dálnici, trajektorie n-tého vozidla bude stejná jako vozidla pøed ním ($n-1$) až na posuny v èase a místì. (Vozidlo bude ve stejném místì jako pøedcházející v jiný èas a ve stejný èas bude na jiném místì.) Všechny další dispozice jednotlivých modelù v sobì tento pøedpoklad obsahují.

\section{Newellùv model}
\label{sec:Newell}

V teorii dopravního proudu je Newellùv model jeden z modelù, který popisuje chování øidièe dle vozidla pøed ním. Øidiè se snaží držet za vozidlem jedoucím pøed ním v konstantní  vzdálenosti. Tento model vznikl v roce 1961 a postupnì se vyvíjel. Vychází z nìho novìjší modely, napø. Intelligent Driver Model (IDM) a z tohoto dùvodu je zde zmínìn.

V èlánku \cite{Newell} je pøesnì popsán nejen model, ale i jeho verifikace a porovnání s ostatními modely. Pro nás je dùležitý popis modelu.

\subsection{Popis modelu}
Jestliže $n$-té vozidlo jede za $n-1$ vozidlem (které jede za $n-2$ vozidlem atd.), cíl každého Car following modelu je zjistit závislost trajektorie $n$-tého vozidla  $x_{\n}(t)$ jeho pozici v èase $t$ na $n-1$ vozidle, viz. obrázek \ref{newell}. (To také znamená, že není žádná náhodná spojitost mezi tìmito vozidly.)
Jestliže se $n-1$ vozidlo pohybuje konstantní rychlostí $v$,
\[
x_{{\nm1}} {}={} x_{\n} + vt,
\]
$n$-té vozidlo také pojede prùmìrnou rychlostí $v$. Pokud by $n$-té vozidlo zrychlovalo, tak by došlo ke kolizi s $n-1$ vozidlem a naopak pokud by zpomalovalo, tak by se $n$-té vozidlo neustále vzdalovalo. Totéž platí pro všechna vozidla jedoucí za $n$-tým. Tento model se nezabývá zjištìním hodnoty rychlosti $v$, pøedpokládá se, že je urèena buïto na základì omezení rychlosti èi možnostech vozidla.

\begin{figure}[ht]%
\centering
\includegraphics[]{images/newell.pdf}%
\caption{Trajektorie vozidel s konstantní rychlostí, zdroj: \cite{Newell}}%
\label{newell}%
\end{figure}

Vzdálenost $s_\n = x_{\nm1} (t) - x_\n (t)$ mezi vozidly $n$ a $n-1$ se mùže mìnit v èase. Pokud je dálnice homogenní, tato vzdálenost zùstane konstantní okolo hodnoty $s_\n$. Tato hodnota se mìní na základì typu vozidla a také závisí na rychlosti $v$.

Pøedpokládejme, že existuje nìjaký empirický vztah mezi rychlostí $v$ a vzdáleností mezi vozidly $s_\n$. Pokud rychlost $v$ roste, je logické, že øidièi chtìjí dosáhnout vìtšího rozestupu mezi vozidly. Tato  závislost mezi $v$ a $s_\n$ je znázornìna na obrázku \ref{vztahmezivas}. Každý øidiè má svoji preferovanou rychlost $\text{V}_\n$. Jestliže rychlost $v$ je u $n-1$ vozidla je vyšší než preferovaná rychlost u $n$-tého, tedy $v>\text{V}_\n$, znamená to, že $n$-té vozidlo pojede svoji preferovanou rychlostí (na obrázku \ref{vztahmezivas} znázornìna èárkovanou èárou) a $n-1$ vozidlo mu ujede.
Hodnota rychlosti $v$ nemùže být záporná a vzdálenost mezi vozidly pøi nulové rychlosti by mìla být níže než polopøímka lineární závislosti, viz èerná teèka na obrázku \ref{vztahmezivas} pøi rychlosti $v=0$.
\begin{figure}[ht]%
\centering
\includegraphics[]{images/vztahmeziSaV.pdf}%
\caption{Vztah mezi rychlostí $v$ a vzdáleností mezi vozidly $s_\n$, zdroj: \cite{Newell}}%
\label{vztahmezivas}%
\end{figure}

Nyní pøedpokládejme, že se $n-1$ vozidlo nìjakou dobu $t$ pohybuje konstantní rychlostí $v$\footnote{hodnota rychlosti osciluje okolo hodnoty $v$} a potom náhle zmìní rychlost na hodnotu $v'$. Trajektorie vozidel $n$ a $n-1$ mohou poté vypadat jako na obrázku \ref{linearaprox}. Z obrázku lze také vypozorovat jak èasovou $\tau_\n$, tak prostorovou $d_\n$ mezeru mezi vozidly $n$ a $n-1$. Z èárkovaného obdelníku poté dostáváme vztah vzdálenost mezi vozidly pøed zmìnou rychlosti $s_\n$ a po zmìnì rychlosti $s'_\n$,
\[
s_\n{}={}d_\n + v\tau_\n,\qquad s'_\n{}={}d_\n + v'\tau_\n. 
\]

Z toho vyplývá, že pokud leží $v$ a $v'$ na polopøímce z obrázku \ref{vztahmezivas}, sklon této pøímky je právì $\tau_\n$ a hodnota $s_n$ pøi rychlosti $v = 0$ je $d_\n$.

Ze vztahu mezi $v$ a $s_\n$, jak je zobrazeno na obrázku \ref{vztahmezivas}, plyne nezávislost mezer $d_\n$ a $\tau_\n$ na rychlostech $v$, resp. $v'$. Pokud se tedy zmìní rychlost z hodnoty $v'$ na $v''$, $d_\n$ a $\tau_\n$ zùstanou pøi této zmìnì rychlosti stejné. Lineární trajektorie vozidla $x_n(t)$ potom bude jednoduše posun v èase $\tau_\n$ a místì $d_\n$,
\begin{equation}
x_\n(t+\tau_\n) {}={} x_{\nm1}(t) - d_\n.
\label{eq:newelxn}
\end{equation}

U Newellova modelu platí, že n-té vozidlo bude (pøibližnì) kopírovat trajektorii n-1 vozidla dle vztahu \eqref{eq:newelxn} pøi vhodných hodnotách $d_\n$ a $\tau_\n$. Tím, jak se pøesnì dokáže n-té vozidlo dodržovat vztah \eqref{eq:newelxn}, se Newellùv model nezabývá, pouze pøedpokládá, že øidiè je schopen se tímto vztahem øídit. To není tak tìžké, protože pokud se zmìní rychlost vozidla $n-1$, n-tý øidiè nemusí zareagovat okamžitì, ale mùže poèkat dokud se mezera $s_\n$ nezvýší (neklesne) na hodnotu, která odpovídá nové rychlosti vozidla n-1 (viz obrázek \ref{vztahmezivas}).
\begin{figure}[ht]%
\centering
\includegraphics[]{images/linearaprox.pdf}%
\caption{Lineární aproximace pøi zmìnì rychlosti vozidel, zdroj: \cite{Newell}}%
\label{linearaprox}%
\end{figure}

Pøi pozorování se došlo k závìru, že každý øidiè nezkoumá každého jiného øidièe na komunikaci, ale pouze jen vhodnou \uv{makroskopickou} èást.

Hodnoty $\tau_\n$ a $d_\n$ jsou pøirozené, to vychází ze vztahu \eqref{eq:newelxn}, kde postupným iterováním dostaneme

\begin{equation}
x_\n(t+\tau_\n + \tau_{\nm1} + \cdots + \tau_1) {}={} x_0(t) - d_\n - d_{\nm1} - \cdots - d_1.
\label{eq:newelxn0}
\end{equation}

Hodnoty $\tau_\n$ a $d_\n$ se znaènì liší mezi jednotlivými vozidly v závislosti na typu øidièe. První skupina øidièù radìji jede blíže vozidlu pøed sebou ($n-1$) až na minimální bezpeènou vzdálenost, zatímco druhá skupina naopak preferuje delší vzdálenost pro klidnou reakci na nenadálou událost. Je rozumné, aby se hodnoty $\tau_n$ a $d_\n$ lišily, a to tak, že každému jednotlivému vozidlu budou hodnoty vygenerovány z nìjakého pravdìpodobnostního rozdìlení, jehož variaèní koeficient se bude blížit jedné. Pøi generování rychlostí vozidel by naopak mìl být variaèní koeficient zanedbatelný.

Položíme-li

\begin{equation}
\overline{\tau}{}={}\frac{1}{n}\sum_{k=1}^n \tau_k,\qquad \overline{d}{}={}\frac{1}{n}\sum_{k=1}^n d_k,
\label{eq:averagedtau}
\end{equation}

kde $\overline{\tau}$ a $\overline{d}$ jsou prùmìrné posuny v èase resp. místì, potom prùmìrnou vlnovou rychlost spoèteme jako podíl $\overline{d}/\overline{\tau}$.

Tento model se dá ovšem popsat nejen mikroskopicky (rychlost, mezera mezi vozidly), ale i makroskopicky (hustota $k$, intenzita $q$). Stacionární stav nastane ve chvíli, kdy se všechna vozidla budou pohybovat konstantní rychlostí s rozdílnými posuny (èasovými i prostorovými). 

Jestliže
\[
s_\n{}={}d_\n + v\tau_\n,
\]
a rychlost vozidel je konstantní, tak platí
\[
\overline{s}{}={}\overline{d} + v\overline{\tau}.
\]

Hustotu $k$ lze potom vypoèítat jako pøevrácenou hodnotu prùmìrné mezery mezi vozidly $k{}={}1/\overline{s}$ a rychlost jako podíl intenzity a hustoty $v = q/k$. Tudíž platí
\begin{equation}
q = \frac{1}{\overline{\tau}} - \frac{\overline{d}}{\overline{\tau}}k,
\label{eq:qk}
\end{equation}

za pøedpokladu, že rychlost $v$ je menší než preferovaná rychlost jakéhokoliv vozidla $V_k$.

Rovnice \eqref{eq:qk} propojuje Newellùv model s klasickými makroskopickými modely. Problém nastává ve chvíli, kdy prùmìrná rychlost $v$ je vyšší, než nìkterá s preferovaných rychlostí jednotlivých vozidel. Vozidla se v tomto modelu nemohou pøedjíždìt a proto vznikne kongesce za vozidlem s malou preferovanou rychlostí. V následujících øádcích pøedpokládáme, že aktuální rychlost vozidla bude menší než preferovaná rychlost $V_\n$.

Uvažujme, že se vozidlo $n$ pohybuje pøesnì podle rovnice \eqref{eq:newelxn} a vozidlo za ním ($n-1$) jede plynule za ním.

Rovnici \eqref{eq:newelxn} mùžeme pøepsat do tvaru
\begin{equation}
x_\n(t+\tau_\n) {}={} x_\n(t) + \tau_\n v_\n(t+T_\n).
\label{eq:xntaun}
\end{equation}
Rovnice \eqref{eq:xntaun} lze pro rovnomìrný pohyb zjednodušit na tvar
\[
x_\n(t+\tau_\n) {}={} x_\n(t) + \tau_\n v_\n(t).
\]
Tvar rovnice \eqref{eq:xntaun} plyne z matematické analýzy\footnote{vìta o støední hodnotì}, pøièemž hodnota $T_\n$ se nachází nìkde mezi nulou a $\tau_\n$. Pokud je funkce hladká bude pøibližnì
\begin{equation}
T_\n = \frac{\tau_\n}{2}.
\label{eq:Tn}
\end{equation}
Rovnici \eqref{eq:xntaun} lze pøepsat na pøibližný tvar
\begin{equation}
x_\n(t+\tau_\n) {}={} x_\n(t) + \tau_\n v_\n(t) + \tau_\n T_\n a_\n(t),
\label{eq:xntaunx}
\end{equation}
který uvažuje zrychlení vozidla $a_\n$\footnote{Pøedpokládejme vozidlo v klidu, které se rozjíždí. Na zaèátku zvolíme $\tau_\n = 5s, t = 0s, T_\n= \tau_\n/2 = 2,5s$, potom platí
\[
x_\n(5) {}={} x_\n(0) + 5 v_\n(0 +2,5).
\]
Pro výpoèet dráhy bereme hodnotu rychlosti v èase 2,5s. Nemùžeme vzít hodnotu v nule, vozidlo by v tomto pøípadì stálo na místì. Pøibližná hodnota bude tedy opravdu v polovinì hodnoty $\tau_\n$. 
}.
Kombinací rovnic \eqref{eq:xntaunx} a \eqref{eq:newelxn} dostáváme vztah pro rychlost
\begin{equation}
v_\n(t+\tau_\n) {}={} \frac{1}{\tau_\n}\left[x_{\nm1}(t)-x_\n(t)\right] - \frac{d_\n}{\tau_\n}.
\label{eq:xntaunv}
\end{equation}
Po zderivování rovnice \eqref{eq:xntaunv} dostáváme vztah pro zrychlení vozidla
\begin{equation}
a_\n(t+\tau_\n) {}={} \frac{1}{\tau_\n}\left[v_{\nm1}(t)-v_\n(t)\right].
\label{eq:xntauna}
\end{equation}
Z rovnic \eqref{eq:xntaunv} a \eqref{eq:xntauna} je vidìt zøejmá závislost na vozidle, které jede pøed aktuálním,  èlenem $v_{\nm1}(t)$, resp. $x_{\nm1}(t)$. Øidiè volí svoji rychlost na základì odstupu od pøedchozího vozidla, resp. zrychlení na základì rychlostí. 

\textbf{Koneèný vztah pro Newellùv model je tedy}
\begin{equation}
a_\n(t) {}={} \frac{\frac{1}{\tau_\n}\left[v_{\nm1}(t)-v_\n(t)\right] - \frac{d_\n}{\tau_\n} - v_\n(t)}{T_n},
\label{eq:newellcompl}
\end{equation}
kde vztah mezi $\tau_\n$ a $T_n$ vychází z rovnice \eqref{eq:Tn}.

U Newellova modelu není vùbec definované èelní vozidlo a jeho vlastnosti. Je napø. možné nastavit mu konstantní rychlost a vlastnosti následujících vozidel vypoèítat poté rovnice \eqref{eq:newellcompl}.




\section{Gippsùv model}
\label{sec:Gipps}

Další model, kterým se zde budeme zabývat, se jmenuje Gippsùv. Tento model byl poprvé popsán v roce 1981 a odvolává se i na zmínìný Newellùv model. I v dnešní dobì se tento model využívá pro simulaci dopravyy. Hlavním zdrojem pro tuto podkapitolu je èlánek P.G. Gippse\cite{Gipps}. Vìtšina modelù, které vznikly pøed Gippsovým, jsou rùzné variace na rovnici
\begin{equation}
a_\n(t+T_n) {}={} l_n\frac{[v_{\nm1}(t) - v_\n(t)]^k}{[x_{\nm1}(t) - x_\n(t)]^m},
\label{eq:othermodels}
\end{equation}
kde jednotlivé promìnné mají stejný význam jako pøi popisu Newellova modelu \ref{sec:Newell}. Promìnné $l_n$, $k$ a $m$ jsou parametry, které je nutno empiricky odhadnout. Tyto modely se nazývají Modely General Motors a jsou blíže rozebrány v \cite{Vanis}.

Aèkoliv podávají tyto modely dobré výsledky v mnoha situacích, je žádoucí, aby bìhem pøepoètù poloh, rychlostí a zrychlení nìjakým zpùsobem byl zahrnut reakèní èas øidièe $T_\n$. To si vyžaduje znaèné množství historických dat, pokud model bude použit v simulaèním programu. Navíc, parametry $l_n$, $k$ a $m$ nemají pøímou souvislost s vlastnostmi vozidla èi øidièe.

Gipps se proto rozhodl, že vytvoøí model, který bude splòovat následujicí podmínky:

\begin{itemize}
	\item model by mìl napodobovat chování opravdového provozu,
	\item parametry modelu by mìly odpovídat vlastnostem øidièe a vozidla, které jsou jasné; to znamená, že pro nastavení parametrù není potøeba model kalibrovat,
	\item model by se mìl chovat správnì i v pøípadì, že doba mezi pøepoèítáváním polohy a rychlosti je stejná, jako reakèní èas øidièe.
\end{itemize}

\subsection{Popis modelu}

Následující model je odvozen z omezení jak øidièe, tak i vozidla a pomocí tìchto omezení se dopoèítávají bezpeèná rychlost podle pøedcházejícího vozidla. Pøedpokládá se pøitom, že øidiè volí svoji rychlost tak, aby zajistil bezpeèné zastavení nebo aby dokázal náhle rychle zastavit pøi nenadálé události.

První podmínka, kterou aplikujeme na vozidlo $n$, souvisí s rychlostí vozidla. Ta nepøekroèí jeho preferovanou rychlost $V_\n$ a jeho zrychlení na volné komunikaci\footnote{tj. komunikace, na které se nevyskytuje žádné další vozidlo} se zvyšuje stejnì tak jako rychlost dokud se také zvyšuje kroutící moment motoru vozidla a poté zaène klesat na nulovou hodnotu a té nabude ve chvíli, kdy se vozidlo bude pohybovat svoji preferovanou rychlostí $V_n$
\begin{equation}
v_\n (t+T_\n) {}={} v_\n (t) + 2,5a_\n \tau \left(\frac{1-v_\n (t)}{V_\n}\right)\sqrt{\left(0,025+\frac{v_\n (t)}{V_\n}\right)}.
\label{eq:inequalitygipps}
\end{equation}

\begin{comment}
 Tento výraz je zcela popisný, pøesná forma zvolena z nìkolika zároveò postaèujících popisù na základì jednoduše získaných výpoètù. 
\end{comment}
Koeficienty v nerovnici \ref{eq:inequalitygipps} byly stanoveny na základì z mìøení na hlavních dopravních komunikacích pøi prùmìrném provozu.  Využití nerovnice \ref{eq:inequalitygipps} pro tento model je považované za pøijatelné až do chvíle, kdy se vozidlo pøiblíží vozidlu jedoucím pøed ním. Od té chvíle dùraz na tuto podmínku klesá, naopak nejvìtší dùležitost je ve chvíli, kdy vozidlo nemá pøed sebou žádné vozidlo èi vozidlo pøed ním se nachází velmi daleko.

Další omezení, které je nutno zmínit, se týká brždìní. Jestliže $n-1$ (první) vozidlo zahájí brždìní v èase $t$, zpomalí a následnì zastaví v místì $x^*_\nm1$, které dostáváme rovnicí
\begin{equation}
x^*_{\nm1} {}={} x_{\nm1} (t) - \frac{v_{\nm1} (t)^2}{2b_{\nm1}},
\label{eq:cometorestnm1}
\end{equation}

kde se èlen $b_{\nm1}$ nazývá nejvyšší kritická decelarace, kterou je øidiè vozidla $n-1$ schopen vykonat. Její hodnota je vždy záporná.

Vozidlo $n$ jedoucí za ním nebude reagovat na toto zpomalení ihned, ale až v èase $t + T_\n$ a tudíž zastaví až v místì $x_\n^*$ dané rovnicí
\begin{equation}
x_\n^* = x_\n (t) +\left[v_\n (t) + v_\n (t+T_n) \right] \frac{T_\n}{2} - \frac{v_{n} (t+T_\n)^2}{2b_{\n}}
\label{eq:cometorestn}
\end{equation}

A proto pro bezpeènost musí øidiè vozidla $n$ zajistit, že bude splnìna podmínka
\begin{equation}
x^*_{\nm1} - s_{\nm1} < x_\n^*,
\label{eq:distance}
\end{equation}
kde $s_{\nm1}$ je délka vozidla $n-1$ seètena s bezpeènou vzdáleností následujícího ($n$) vozidla. Nicménì pokud tato podmínka neplatí, vozidlo nemá žádný prostor pro pøípadnou øidièovu chybu. Z toho dùvodu obsahuje tento model ještì další podmínku; bezpeèný odstup s další èasovou rezervou, $\theta$. Øidiè zaène reagovat na vozidlo pøed sebou až v èase $t+T_\n$. Od této chvíle tedy máme reakèní èas $T_\n$ a bezpeèný reakèní èas $T_\n + \theta$, který budeme ve výpoètech dále využívat. S využitím rovnic \eqref{eq:cometorestnm1}, \eqref{eq:cometorestn} a \eqref{eq:distance} mùžeme tuto podmínku pøepsat do rovnice
\begin{equation}
x_{\nm1} (t) - \frac{v_{\nm1} (t)^2}{2b_{\nm1}} - s_{\nm1} {}\geq{} x_\n (t) +\left[v_\n (t) + v_\n (t+T_n) \right] \frac{T_\n}{2} + v_\n (t+T_n) \theta - \frac{v_{\n} (t+T_\n)^2}{2b_{\n}}
\label{eq:theta}
\end{equation}

Bez parametru $\theta$ by øidiè vozidla byl nucen brzdit až ve chvíli, kdy opravdu musí, to znamená na maximální výkon brzd. Do té chvíle by se stále pohyboval svoji preferovanou rychlostí. Parametr $\theta$ slouží k døívìjšímu a pøitom ne tak prudkému brždìní.

Pøi skuteèném pozorování dopravy jsme schopni zmìøit všechny parametry vozidla $n$ v rovnici \eqref{eq:theta} kromì èlenu $b_{\nm1}$. Tento èlen nahradíme odhadnutou hodnotou $\hat{b}$, upravíme tuto rovnici a dostáváme
\begin{equation}
- \frac{v_{n} (t+T_\n)^2}{2b_{\n}} + v_\n (t+T_n) \left(\frac{T_\n}{2} + \theta\right) - \left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right] + v_{\n} (t) \frac{T_\n}{2} + \frac{v_{\nm1} (t)^2}{2\hat{b}} \leq 0.
\label{eq:replacebn}
\end{equation}

Relativní hodnoty $T_n$ a $\theta$ jsou dùležité v urèování chování vozidel. Stejnì jako v pøípadì Newellova modelu \ref{sec:Newell}, \eqref{eq:Tn}, pokud je hodnota $\theta$ rovna právì jedné polovinì $T_\n$, vozidlo jedoucí bezpeènou rychlostí bude schopno udržovat tento stav nekoneènì dlouhou dobu. Díky tomu mùžeme rovnici \eqref{eq:replacebn} pøepsat do tvaru
\begin{equation}
- \frac{v_{n} (t+T_\n)^2}{2b_{\n}} + v_\n (t+T_n) T_\n - \left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right] + v_{\n} (t) \frac{T_\n}{2} + \frac{v_{\nm1} (t)^2}{2\hat{b}} \leq 0.
\label{eq:replacetheta}
\end{equation}

Z toho plyne
\begin{equation}
v_{\n} (t+T_\n) \leq b_{\n}T_\n + \sqrt{\left(b_{\n}^2 T_\n^2 - b_{\n}\left(2\left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right] - v_{\n} (t)T_\n - \frac{v_{\nm1} (t)^2}{2\hat{b}} \right)\right)}.
\label{eq:nextreplace}
\end{equation}

Z nerovnice \eqref{eq:replacetheta} vychází, že bezpeèné rychlosti $v_\n$ budou ležet mezi dvìma koøeny této nerovnice, ale pokud bude mít spodní koøen zápornou hodnotu mùžeme ho ignorovat, protože nás zajímají pouze kladné hodnoty rychlostí. Podcenìní plynulého brždìní øidièe vozidla $n$ nastane ve chvíli, kdy
\[
v_{\n} (t+T_\n) < v_\n (t) + b_n T_n.
\]

V tuto chvíli musí vozidlo zaèít brzdit rychleji, než by sám øidiè chtìl. Øidiè tedy volí rychlost na základì preferované decelarace, ale mùže brzdit i rychleji pokud by to bylo nutné.

Nerovnice \eqref{eq:inequalitygipps} pro vozidlo $n$ na volné komunikaci a \eqref{eq:nextreplace} pro vozidlo $n$ pøed kterým se nachází vozidlo $n-1$ pøedstavují dvì hlavní podmínky pro rychlost $v_\n$ v èase $t + T_\n$ a jestliže øidiè pøizpùsobí rychlost parametrùm vozidla a tak, aby jízda byla bezpeèná, dostáváme \textbf{koneèný vztah pro Gippsùv model:}
\begin{equation}
\begin{split}
v_{\n} (t+&T_\n) = \min \left( v_\n (t) + 2,5a_\n \tau \left(\frac{1-v_\n (t)}{V_\n}\right)\sqrt{\left(0,025+\frac{v_\n (t)}{V_\n}\right)},\right.\\
&\left. b_{\n}T_\n + \sqrt{\left(b_{\n}^2 T_\n^2 - b_{\n}\left(2\left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right] - v_{\n} (t)T_\n - \frac{v_{\nm1} (t)^2}{2\hat{b}} \right)\right)}\;\right)
\label{eq:gipps}
\end{split}
\end{equation}

Pokud platí pro témìø všechna vozidla nižší hodnota v rovnici \eqref{eq:gipps}, vychází se z nerovnice \eqref{eq:nextreplace}, vozidla jedou blízko sebe, z èehož vyplývá vysoká hustota provozu. Pokud platí opak, tz. nerovnice \eqref{eq:inequalitygipps}, dopravní proud je volný.

\section{Kraussùv model}
\label{sec:Krauss}
Pro simulaci v této práci budeme využívat software SUMO\footnote{Simulation of Urban MObility} a souèástí tohoto programu je pøedpøipravený Kraussùv model vytvoøený v rámci disertaèní práce stejnojmeného autora. V popisu tohoto modelu budeme vycházet z této práce\cite{Krauss}.

Tento model se zamìøuje pøimárnì na všeobecné vlastnosti dopravního proudu, zkoumání chování øidièe zde není primární. Myšlenka autora je taková, že existují obecné vlastnosti dopravního proudu, ze kterých vyplývá chování jednotlivých úèastníkù silnièního provozu a není to chování jednotlivce, které hlavnì ovlivòují vlastnosti dopravního proudu.

\subsection{Obecný pøístup}
\label{krauss:approach}
Pokud se dopravní proud modeluje mikroskopicky, musí být brány v úvahu dva typy pohybu vozidla. Prvním typem pohybu je vozidlo jedoucí po vozovce osamoceno, zatímco ve druhém pøípadì vozidlo interaguje s ostatními vozidly. Na základì tìchto pohybù pøedpokládáme následující podmínky. První podmínka má pøímo souvislost s rychlostí vozidla. Ta je omezena nìjakou maximální rychlostí $v_{\max}$,
\begin{equation}
v \leq v_{\max}.
\label{eq:kraussvmax}
\end{equation}
Za maximální rychlost mùže být napøíklad zvolena preferovaná rychlost vozidla.

Hlavní dùvod, proè mezi sebou vozidla interagují, je fakt, že øidièi nemají v úmyslu srážet se s ostatními vozidly. Další podmínkou tedy bude tzv. \uv{nekoliznost} systému. Budeme pøedpokládat, že øidiè vozidla zvolí tedy takovou rychlost vozidla, která nebude vyšší než maximální bezpeèná rychlost $v_{\safe}$,
\begin{equation}
v \leq v_{\safe}.
\label{eq:kraussvsafe}
\end{equation}

Z maximální bezpeèné rychlosti poté plyne interakce mezi vozidly. Její stanovení bude uvedeno dále.

Je možné formulovat modely na základì podmínek \eqref{eq:kraussvmax} a \eqref{eq:kraussvsafe}. Nicménì je vcelku vhodné pøedpokládat také omezující podmínky pro zrychlení,
\begin{equation}
\begin{split}
&-b \leq \frac{dv}{dt} \leq a,\\
&a,b > 0.
\label{eq:kraussa}
\end{split}
\end{equation}

Pozdìji bude ukázáno, že podmínka \eqref{eq:kraussa} je nezbytnou složkou, pokud chceme modelovat dopravní proud správnì.


Pøedchozí podmínky mùžeme shrnout do následující nerovnice
\begin{equation}
v(t+ \Delta t) \leq \min (v_{\max}, v_{\safe}, v(t)+a \Delta t),
\label{eq:kraussvtdt}
\end{equation}
kde se maximální bezpeèná rychlost $v_{\safe}$ musí splòovat podmínku
\begin{equation}
v(t+ \Delta t) \geq v(t) - b\Delta t.
\label{eq:kraussvsafecalc}
\end{equation}

Celkové povìdomí o tom, jak se jednotlivá vozidla pohybují a interagují mezi sebou závisí na výpoètu maximální bezpeèné rychlosti $v_{\safe}$. Jakmile je stanovena hodnota $v_{\safe}$, nerovnice \eqref{eq:kraussvtdt} pøedstavuje aktualizované schéma pro simulace dopravního proudu, pokud jsou splnìny všechny podmínky zmínìné výše.

\subsection{Interakce mezi vozidly}

Pro vytvoøení sofistikovaného dopravního modelu je nutné ukázat, jak vozidla mezi sebou interagují. Podívejme se na dvì vozidla na komunikaci, první vozidlo se nachází v bodì $x_1$ a jede rychlostí $v_1$, vozidlo, které ho následuje je v bodì $x_f$ a pohybuje se rychlostí $v_f$. Jestliže délka prvního vozidla bude $l$, tak mezera mezi vozidly se vypoète vztahem
\begin{equation}
g = x_1 - x_f - l.
\label{eq:kraussgap}
\end{equation}

Jak již bylo zmínìno, hlavní dùvod, proè mezi sebou vozidla interagují, je fakt, že øidièi nemají v úmyslu srážet se s ostatními vozidly. Z toho plyne, že mezera mezi vozidly musí být nezáporná. Narozdíl od jiných modelovaných pøístupù, zde nezaèneme s pøedpokladem jak mùže být zrychlení vozidla vypoèteno z vozidla jedoucí pøed ním, protože nekoliznost stejnì není splnìna automaticky a nìkdy je velice složité ji dokázat.

Místo toho zaèneme zavedením toho, že se v spojitých modelech spolu interagující vozidla nesrazí tehdy, pokud je mezera mezi vozidly $g$ vìtší než nìjaká preferovaná mezera mezi vozidly $g_{\des}$ a splòuje tuto dynamickou nerovnici
\begin{equation}
\frac{dg}{dt} \geq \frac{g_{\des} - g}{\tau_{\des}}. 
\label{eq:kraussgapdes}
\end{equation}

Preferovaný bezpeèný èasový odstup mezi vozidly $\tau_{\des}$ a preferovaná mezera $g_{\des}$ by mohly funkcemi odstupu mezi vozidly èi jejich rychlostmi. Fakt, že v tomto modelu nemohou nastat kolize je zøejmá, protože pokud položíme $g$ rovné nule èasová derivace bude vždy nezáporná a preferovaná mezera $g_{\des}$ také.

Pøedpokládejme pøípad dvou vozidel jedoucími rychlost $v_1$ resp. $v_f$ s odstupem $g$. Druhé vozidlo jede svoji bezpeènou rychlostí a øidiè tohoto vozidla mùže zastavit za jakýkoliv okolností tak, aby nedošlo ke kolizi s prvním vozidlem. To znamená, že pokud øidiè má reakèní èas $\tau$ a brzdná vzdálenost vozidel jedoucích rychlostí $v$ je dána funkcí $f(v)$, je situace bezpeèná právì tehdy když
\begin{equation}
f(v_f) + v_f \tau \leq f(v_1) + g. 
\label{eq:kraussdvsafe}
\end{equation}

Hodnota funkce $f(v)$ nemusí být nutnì minimální možná brzdná vzdálenost, ale mùže to být jiná funkce závisející na zpùsobu øízení øidièe a pohodlné jízdy. To samé platí pro reakèní èas $\tau$.

Úprava nerovnice \ref{eq:kraussdvsafe} vede k bezpeènostnímu pravidlu pro rychlost druhého vozidla. Nicménì my toto pravidlo neodvozujeme ze dvou dùvodù. První z nich je ten, že po úpravì bychom potøebovali znát pøesný pøedpis funkce $f(v)$, který jak uvidíme není možné zjistit. Zadruhé je zbyteèné a výpoèetnì nároèné používat typ øízení, které potøebuje pøedvídat nenádalou událost a vypoèítávat decelaraci až k úplnému zastavení každý jednotlivý krok. Proto zavedeme Taylorùv rozvoj brzdné vzdálenosti $f(v)$ okolo prùmìrné rychlosti obou vozidel,
\begin{equation}
\overline{v} = \frac{v_1 + v_f}{2},
\label{eq:kraussv1vf}
\end{equation}
který budeme v dalším odvození dále používat. Sudé èleny tohoto rozvoje se vyruší a zanedbáním èlenù vyšších øádù dostáváme
\begin{equation}
f'(\overline{v})v_f + v_f \tau \leq f'(\overline{v})v_1 + g. 
\label{eq:kraussdvsafeaverage}
\end{equation}

Smysl derivace $f(\overline{v})$ vysvìtlíme jednoduše. Pokud se podívame na decelaraci vozidla $b$ z rychlosti $v$ na nulu (nemusí být nutnì konstantní), tedy $\dot{v} = -b(v)$, kdy $b(v)>0$, obrdžíme vztah
\begin{equation}
f'(v) = -\frac{d}{dv}\int_v^0 \frac{v'}{b(v')} dv' = \frac{v}{b(v)}
\label{eq:kraussintegratebv}
\end{equation}

Nyní mùžeme pøepsat podmínku bezpeènosti do tvaru
\begin{equation}
v_1 - v_f \geq \frac{v_1 \tau - g}{\frac{\overline{v}}{b(\overline{v})} + \tau},
\label{eq:krausssafetycond}
\end{equation}
kde
\begin{equation}
v_1 - v_f = \frac{dg}{dt}.
\label{eq:krausssdgdt}
\end{equation}

Nerovnice \eqref{eq:krausssafetycond} se v podstatì rovná nerovnici \eqref{eq:kraussgapdes}, kde preferovaný odstup $g_{\des} = v_1 t$ a preferovaný bezpeèný èasový odstup mezi vozidly $\tau_{\des} = \tau_b + \tau$, kde $\tau_b = \overline{v}/b(\overline{v})$ je stanoveno na základì decelerací, které øidiè využije. 

\subsection{Diskretizace modelu}

Nerovnice v èásti \ref{krauss:approach} je potøeba pøevést na diskrétní rovnice pro dráhy, rychlosti a zrychlení pro možnost simulace na poèítaèi.

Vhodná cesta pro vytvoøení rovnic dynamického systému z bezpeènostní podmínky \eqref{eq:kraussgapdes} je pøevést spojitou rychlost $v_f$ ve výrazu $\dot{g}(t) = v_1(t) - v_f(t)$ jako rychlost diskrétní s diferencí èi integraèním krokem $t + \Delta t$. Potom rovnici \eqref{eq:kraussgapdes} pøepíšeme do tvaru
\begin{equation}
v_f (t + \Delta t) \leq v_1(t) + \frac{g(t) - g_{\des}}{\tau_{\des}}.
\label{eq:krausssdiscvf}
\end{equation}
Rovnice pro polohu vozidla se potom na stejném principu pøevede na
\begin{equation}
x (t + \Delta t) = x(t) + v(t + \Delta t)\Delta t.
\label{eq:krausssdiscx}
\end{equation}
Víme, že pøi $\Delta t \rightarrow 0$ a $g_{\des} \geq 0$ rovnice \eqref{eq:krausssdiscvf} a nerovnice \eqref{eq:krausssdiscx} garantují bezpeènost. Pro koneèný èas $\Delta t$ musí být tato garance opìt dokázána.

Mezera $g(t)$ mezi dvìma vozidly je diskretizována vztahem
\begin{equation}
g (t + \Delta t) = g(t) + \Delta t (v_1(t + \Delta t) - v_f(t + \Delta t)).
\label{eq:krausssdisgap}
\end{equation}

Pøidáním rovnice \eqref{eq:krausssdiscvf} dostáváme
\begin{equation}
\xi (t + \Delta t) = \xi(t) + \left(1 - \frac{\Delta t}{\tau_b + \tau}\right) + \Delta t \frac{g_{\des} - v_1(t)\Delta t}{\tau_b + \tau},
\label{eq:krausssdisxit}
\end{equation}
kde 
\[
\xi (t) = g(t)  - v_1(t) \Delta t.
\]

Bezpeènost ($g \geq 0$) je tedy garantována tehdy, když platí:
\begin{equation}
\begin{split}
&\xi (t=0) \geq 0,\\
&\Delta t \leq \tau,\\
&g_{\des} \geq v_1 \Delta t.
\label{eq:krausssafetygarance}
\end{split}
\end{equation}
To je výsledek, který se ovšem dal pøedpokládat. Záleží pouze na tom, zda je i po provedení iteraèního kroku stále splnìna podmínka bezpeènosti, tz. kontrolovat jestli je náš iteraèní krok menší než reakèní èas øidièe $\tau$.

\subsection{Rovnice modelu} 

Pøedpokládáme tedy, nezávisle na náhodném kolísání, že každé vozidlo se pohybuje nejvyšší rychlostí na základì podmínek, které jsou stanoveny níže. \textbf{Kraussùv model tedy stanovíme následujícími rovnicemi:}
\begin{equation}
\begin{split}
&v_{\safe} (t) = v_1(t) + \frac{g(t) - g_{\des}}{\tau_b + \tau},\\
&v_{\des} = \min [v_{\max}, v(t) + a(t) \Delta t, v_{\safe} (t)],\\
&v (t + \Delta t) = \max[0, v_{\des} - \eta].
\label{eq:krausssmodel}
\end{split}
\end{equation}

Preferovaná mezera $g_{\des}$ mùže být zvolena rùznì. Vìtšinou se volí $g_{\des} = v_1 \tau$, kde $\tau$ je reakèní èas øidièe. Hodnota $\tau_b$ je definována jako podíl $\overline{v}/b$, kde $\overline{v}$ plyne ze vztahu \eqref{eq:kraussv1vf}. Novì zde také zavádíme promìnnou $\eta$, která je náhodnou výchylkou od bìžného øízení. Volba integraèního kroku $\Delta t$ a preferované mezery $g_{\des}$ je závislá na podmínkách \eqref{eq:krausssafetygarance}.

\section{Intelligent Driver Model}

V této sekci budeme primárnì vycházet z práce \cite{Vanis}, ve které je Intelligent Driver Model (IDM) do znaèné míry rozebrán. Využijeme hlavnì podkapitolu 5.1 z \cite{Vanis}, kterou doplníme o poznatky, které jsou uplatnìny z kapitoly \ref{chap:predIDM}.

Intelligent Driver Model (IDM) je pomìrnì nový matematický model z roku 2000, který byl vymyšlen v Nìmecku. Snaží se vylepšit nìkteré nedostatky pøedcházejících modelù, ale i pøispìt novými myšlenkami v této oblasti.

\subsection{Matematický popis}
\label{sec:matpopisIDM}
 
Pro výpoèet zrychlení v IDM je použit vztah
\begin{equation}
\dot{v}_n = a_\free + a_\inter,
\label{soucetzrych}
\end{equation}
kde se aktuální zrychlení úèastníka vypoèítá jako souèet zrychlení pøi volném proudu $a_\free$ a zrychlení, ve kterém je zahrnut i úèastník jedoucí pøed ním $a_\inter$. Zde je vidìt urèitá paralela s Gippsovým modelem (kapitola \ref{sec:Gipps}, kde se ovšem vybírá pouze jedna z tìchto dvou hodnot. Navíc i rovnice se od IDM odlišují. Pro volný proud je tedy zrychlení $a_\inter {}={} 0$.

Zrychlení pøi volném proudu je definováno vztahem
\begin{equation}
a_\free {}={} a\left[1-\left(\frac{v_n}{v_{n\free}}\right)^\delta\right],
\label{zrychvolproud}
\end{equation}
kde $a$ je maximální zrychlení, $\delta$ je exponent zrychlení, $v_n$ je aktuální rychlost vozidla a $v_{n\free}$ je rychlost, které chce vozidlo dosáhnout.

Pokud v rovnici \eqref{zrychvolproud} bude zlomek $v_n / v_\free$ roven jedné, auto se již dostalo na svou preferovanou rychlost $v_\free$ a celkové zrychlení $a_\free$ bude rovno nule. Naopak pokud bude $v_n$ rovno nule, znamená to, že $a_\free$ bude pøímo rovno $a$, a auto pojede svým maximálním zrychlením. Pokud $v_n$ bude menší než $v_\free$, pak platí že, èím vyšší hodnotu bude mít nastavenou parametr $\delta$, tím se dosáhne vyšší hodnota  $a_\free$. Pokud $v_n$ bude vìtší než $v_\free$, bude platit pravý opak.

Auto jedoucí pøi volném proudu je ale nereálná pøedstava, proto se do rovnice \eqref{soucetzrych} pøidává interakèní èlen, který pøímo závisí na parametrech vozidla jedoucí pøed naším úèastníkem. Tento èlen je roven
\begin{equation}
a_\inter = - a \left(\frac{s_n^*}{s_n}\right)^2,
\label{intclen}
\end{equation}
kde $a$ je maximální zrychlení, $s_n = x_{n-1} - x_n$ je rozdíl poloh vozidel a $s_n^*$
\begin{equation}
s_n^* = s_\text{0} + v_n T + \frac{v_n(v_n - v_{n-1})}{2\sqrt{ab}}
\label{snhvez}
\end{equation}
je preferovaný odstup. Hodnota $s_\text{0}$ se vypoète jako souèet minimální bezpeèné vzdálenosti mezi vozidly a délkou následujícího vozidla, $T$ je bezpeènostní èasový odstup mezi vozidly a $b$ je konstanta brzdìní. Situace je schématicky znázornìna na obrázku \ref{promen}.

Èlen úmìrný $v_n - v_{n-1}$ je kvadratický v promìnné $v_n$ a obsahuje souèin $v_n v_{n-1}$. Tyto nelineární èleny popisují interakci, v tomto pøípadì dvou vozidel. Pokud tedy bude vzdálenost $s_n$ mezi auty vysoká, potom zlomek $s_n^*/s_n$ bude mít velmi malou hodnotu a interakèní èlen $a_\inter$ lze zanedbat, takže vozidlo se pohybuje jako ve volném proudu.
\begin{figure}%
\centering
\includegraphics[width=0.6\textwidth]{idm.pdf}%
\caption{Promìnné jednotlivých aut}%
\label{promen}%
\end{figure}


Pokud rychlost auta $v_n$ bude vyšší než rychlost auta $v_{n-1}$, pak interakèní èlen $s_n^*$ bude kladný a požadovaný odstup se zvìtší, takže zrychlení auta $\dot{v}_n$ se musí snížit.

\section{Shrnutí}

Èasovì spojité mikroskopické modely bez pøedjíždìní jsou v zásadì definovány funkcí zrychlení. V nejstarších modelech mùže zrychlení $\dot{v} (t + T_r)$ vozidla $\alpha$ zapsáno jako
\begin{equation}
\dot{v} (t + T_r) = \frac{-\lambda v_\alpha^m \Delta v_\alpha}{s_\alpha^l},
\label{eq:earliermodels}
\end{equation}
kde $\lambda$, $l$ a $m$ jsou parametry modelu, $s$ je odstup mezi vozidly a $\Delta v_\alpha$ rozdíl rychlostí.

Kromì toho, mùže zrychlení mùže také záviset na vlastní rychlosti vozidla $v_\alpha$ a klesá se vzdáleností $s_\alpha$ k vozidlu pøed ním,
\begin{equation}
s_{\alpha} = x_{\alpha-1} - x_{\alpha} - l_{\alpha},
\label{eq:distancebetween}
\end{equation}
kde $l_{\alpha}$ je délka vozidla $\alpha$.

V závislosti na rovnici \eqref{eq:earliermodels}, kdy zrychlení závisí na vedoucím vozidle, tyto modely není možné použít pøi velmi nízkých hustotách provozu. Pokud není urèeno vedoucí vozidlo ($s_{\alpha} \rightarrow \infty$), zrychlení buïto není možné stanovit (pro hodnotu $l = 0$) nebo je rovné nule ($l > 0$) bez ohledu na rychlost vozidla. Dá se pøedpokládat, že v tuto chvíli se vozidla budou snažit dosáhnout své preferované rychlosti. Chování vozidel v hustém provozu je ovšem ponìkud nerealistické. Pøedevším odstup mezi vozidly $s$ týkající se vedoucího vozidla nemusí nutnì smìøovat k rovnovážnému stavu. Ani malé mezery nepøimìjí vozidlo k brždìní pokud je rozdíl rychlostí $\Delta v_\alpha$ roven nule.

Tyto problémy byly vyøešeny v Newellovì modelu (viz. odstavec \ref{sec:Newell}), kde je z rovnice \eqref{eq:newellcompl} vidìt, že zrychlení není závislé pouze na rozdílù rychlostí. Newellùv model je nekolizní, ale okamžitá závislost na rychlosti na hustotì provozu vede k velmi vysokým hodnotám zrychlení.\cite{Treiber}

Kromì Newellova modelu a dalších modelù pro základní výzkum existují také vysoce komplexní modely jako napø. Wiedemannùv. Ten se snaží napodobovat dopravu jak nejlépe to jde ovšem za cenu mnoha parametrù modelu.

Další model, který obsahuje realistické brzdné reakce øidièù, je Gippsùv model \ref{sec:Gipps} (brzdný koeficient $b_n$) a Kraussùv model \ref{sec:Krauss} (brzdný koeficient $b$). Navzdory své jednoduchosti, tyto modely ukazují realistické chování øidièe a jsou nekolizní. Toto chování se bohužel ztrácí ve chvíli, kdy modelujeme dopravu deterministicky\footnote{napø. když vozidla vjíždí do urèité oblasti každých 5 sekund}. Tím pádem není možné simulovat nestabilní stavy dopravy.
