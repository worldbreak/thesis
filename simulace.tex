\chapter{Simulace}

V této kapitole nasimulujeme provoz na Pražském okruhu od kilometru 22 do 14 km. Data z mýtných brán máme k dispozici pøibližnì po dvou kilometrech, celkem jich je 6. 

Grafický podklad byl naimportován s OSM viz pøíloha \ref{chap:netSUMO}, nicménì po pøevedení do formátu SUMO nìkteré úseky nejsou zobrazeny pro simulaci úplnì pøesnì.

Postupnì nasimulujeme tento úsek Gippsovým, Kraussovým, IDM a Wiedemannovým modelem a poté zkusíme jednotlivé modely porovnat. Modely se pøedtím pokusíme nakalibrovat tak, že vezmeme hodnoty doporuèené pro simulaci autory a dále je budeme spøesòovat. Jako kritériem pro validní model použijeme GEH \ref{sec:GEH}.

Na zaèátku bych chtìl zmínit rozdíly v modelech mezi kapitolou \ref{chap:predIDM} a implementacemi jednotlivých modelù.

\section{Zmìny modelù}

Rozdíly mezi definicí a implementací modelù jsou vìtšinou zpùsobeny samotným simulaèním nástrojem èi velkým množstvím parametrù. SUMO umožòuje jednoduše zjistit pouze rychlost pøedního vozidla a odstup mezi aktuálním a pøedním vozidlem.

\subsection{Gippsùv model}

Gippsùv model je naimplementován stejnì tak, jak zní rovnice \eqref{eq:gipps}. Jediná drobná zmìna nastává u výpoètu èlenu $\left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right]$, kde není možné získat parametr $s_{\nm1}$. Proto jsme upravili tento èlen jako souèet vzdálenosti mezi vozidly (pøedek aktuálního vozidla a zadek vedoucího vozidla) a k ní jsme pøièetli minimální bezpeènostní odstup.

\subsection{Kraussùv model}

Hlavní zdroj pro vylepšení Kraussùv model je pøímo èlánek pro implementaci rozšíøeného Kraussova modelu \cite{Song}.
Implementovaný model v SUMO není pøímo Kraussùv model (viz rovnice \eqref{eq:krausssmodel}), ale vychází z nìj. Druhým základem pro toto vylepšení Kraussova modelu plyne z procesu brždìní.

\subsubsection{Proces brždìní}

Fáze brzdícího procesu na sebe plynule navazují, první z nich se nazývá doba reakce øidièe $t_r$, dále zvyšování decelarace $t_i$ a maximální brždìní $t_c$. Vše je graficky znázornìno na obrázku \ref{brzdeni}. 

\begin{figure}%
\centering
\includegraphics[width=0.6\textwidth]{images/kraussbrzdeni.pdf}%
\caption{Fáze brždìní}%
\label{brzdeni}%
\end{figure}

\paragraph{Doba reakce øidièe} Øidiè potøebuje urèitý èas \footnote{v kapitole \ref{chap:predIDM} reakèní èas $T_n$} $t_r$ na to, aby zareagoval na vozidlo pøed sebou. V dobì této reakce se rychlost vozidla $v_0$ pohybuje na konstantní hodnotì, pøípadnì se lehce mìní. Posunutí aktuálního vozidla je potom dán rovnicí
\begin{equation}
S_r = v_0 t_r.
\label{eq:posunkrauss}
\end{equation}

\paragraph{Zvyšování decelerace} Decelarace aktuálního vozidla se ve druhé fázi zvyšuje z nuly na hodnotu $b_{\max}$, která pøedstavuje nejvyšší hodnotu decelerace vozidla. Pøedpokládáme lineární zvyšování decelarace, tz.
\[
b = b_{\max} \frac{t}{t_i}.
\]

Aktuální rychlost vozidla se potom vypoète jako
\begin{equation}
v_i = v_0 - \int{b_{\max}\frac{t}{t_i} dt} = v_0 - \frac{b_{\max}}{2t_i} t^2,
\label{eq:speedKrauss}
\end{equation}

a pohyb vozidla v této èásti
\begin{equation}
S_i = \int_0^{t_i}{\left(v_0 - \frac{b_{\max}}{2t_i} t^2\right) dt} = v_0 t_i - b_{\max} \frac{b_{\max} t_i^2}{6}.
\label{eq:moveKrauss}
\end{equation}

\paragraph{Maximální brždìní}
V tuto chvíli již vozidlo brzdí svoji maximální decelerací $b_{\max}$, pohyb vozidla je potom dán vzorcem
\begin{equation}
S_c = \frac{v_0^2}{2b_{\max}} - \frac{v_0 t_i}{2} + \frac{b_{\max} t_i^2}{8}.
\label{eq:moveMaxDecelKrauss}
\end{equation}

\paragraph{Celková dráha pøi brždìní}
Celková dráha pøi brždìní vozidla se vypoèítá jako souèet tøí pøedcházejících èástí, tedy
\[
S = S_r + S_i + S_c = v_0 t_r + v_0 t_i - b_{\max} \frac{b_{\max} t_i^2}{6} + \frac{v_0^2}{2b_{\max}} - \frac{v_0 t_i}{2} + \frac{b_{\max} t_i^2}{8},
\]

a po úpravách dostaneme vztah
\begin{equation}
S = v_0 t_r + \frac{1}{2} v_0 t_i + \frac{v_0^2}{2b_{\max}} - \frac{b_{\max} t_i^2}{24} \approx v_0 \left(t_r + \frac{1}{2}t_i \right) + \frac{v_0^2}{2b_{\max}},
\label{eq:MoveTogetherKrauss}
\end{equation}

kde èlen $- \frac{b_{\max} t_i^2}{24}$ zanedbáme, jelikož má nìkolikrát menší hodnotu než ostatní.

\subsubsection{Simulaèní model vycházející z Kraussova modelu}

Dle Krausse je hlavnì bezpeèná rychlost klíè ke správnému Car-Following modelu. Pokud èelní vozidlo sníží rychlost, aktuální vozidlo musí zaèít brzdit. Pokud obì vozidla zastaví, jejich polohu bude možno vypoèíst na základì vztahu
\begin{equation}
S_l + g(t) = S_f,
\label{eq:diffdispKrauss}
\end{equation}

kde $S_l$ pøedstavuje polohu èelního vozidla, $g (t)$ mezeru mezi obìma vozidly a $S_f$ polohu aktuálního vozidla.

Pokud pomineme reakèní èas èelního øidièe, brždìní se skládá ze dvou èástí probíhajících v èase: zvyšování decelarace $t_{li}$ a maximální brždìní $t_{lc}$.

Poloha èelního vozidla je v celém brzdícím prùbìhu dána rovnicí
\begin{equation}
S_l = S_{li} + S_{lc} = \frac{1}{2} v_l t_{li} + \frac{v_l^2}{2a_{\max}} - \frac{b_{\max} t_{li}^2}{24} \approx \frac{1}{2} v_l t_{li} + \frac{v_l^2}{2a_{\max}},
\label{eq:S_lKrauss}
\end{equation}
kde $a_{\max}$ je maximální decelerace èelního vozidla.

Poloha aktuálního vozidla (vozidla jedoucího za èelním) je v celém brzdícím procesu rovna
\begin{equation}
S_f = S_r + S_i + S_c = v_{\safe} t_r + \frac{1}{2} v_{\safe} t_{i} + \frac{v_{\safe}^2}{2b_{\max}} - \frac{b_{\max} t_{fi}^2}{24} \approx v_{\safe} \left(t_r + \frac{1}{2}t_{fi} \right) + \frac{v_{\safe}^2}{2b_{\max}}.
\label{eq:S_fKrauss}
\end{equation}

Pokud do rovnice \eqref{eq:diffdispKrauss} dosadíme za $S_l$ (rovnice \eqref{eq:S_lKrauss}) a za $S_f$ (rovnice \eqref{eq:S_fKrauss}) dostáváme
\begin{equation}
v_{\safe} \left(t_r + \frac{1}{2}t_{fi} \right) + \frac{v_{\safe}^2}{2b_{\max}} - \frac{1}{2} v_l t_{li} - \frac{v_l^2}{2a_{\max}} - g = 0.
\label{eq:vsafeKrauss0}
\end{equation}

Z rovnice \eqref{eq:vsafeKrauss0} už mùžeme pøes výpoèet diskriminantu vyjádøit $v_{\safe}$:
\begin{equation}
v_{\safe} = -b \left(t_r + \frac{t_{fi}}{2}\right) + \sqrt{b^2 \left(t_r + \frac{t_{fi}}{2}\right)^2 + b\left(v_l t_{li} + \frac{v_l^2}{a} + 2g\right)}.
\label{eq:vsafeKrauss}
\end{equation}

V simulaci je potom èas decelerace stejný $t_i = t_{li} = t_{fi}$, z toho plyne
\begin{equation}
v_{\safe} = -b \left(t_r + \frac{t_{i}}{2}\right) + \sqrt{b^2 \left(t_r + \frac{t_{i}}{2}\right)^2 + b\left(v_l t_{i} + \frac{v_l^2}{a} + 2g\right)},
\label{eq:vsafeKraussti}
\end{equation}

pokud èelní vozidlo stojí, je jeho rychlost $v_l = 0 ms^{-1}$ a jeho poloha se nemìní $S_l = 0$, potom mùžeme zjednodušit rovnici \eqref{eq:vsafeKraussti} na
\begin{equation}
v_{\safe} = -b \left(t_r + \frac{t_{i}}{2}\right) + \sqrt{b^2 \left(t_r + \frac{t_{i}}{2}\right)^2 + 2bg}.
\label{eq:newKrauss}
\end{equation}

Pøesnì rovnice \eqref{eq:newKrauss} je pøímo naprogramována v SUMO a je jakýmsi doplòkem ke Kraussovu modelu, pouze pøesnìji definuje bezpeènou rychlost. Princip Kraussova modelu stále zùstává ve volbì preferované rychlosti, kterou se vozidlo bude pohybovat. Tato volba je dána minimální hodnotou, viz rovnice \eqref{eq:krausssmodel}.

