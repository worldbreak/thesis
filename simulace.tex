\chapter{Simulace}
\label{chap:simulace}
V~této kapitole se pokusím vyhodnotit nasimulované vısledky z~modelù. Simulován bude osmikilometrovı úsek na Praském okruhu mezi 22. a 14. kilometrem ve smìru od D5 na D1. Data z~mıtnıch brán máme k~dispozici pøiblinì po dvou kilometrech, celkem jich je 6 -- viz obrázek \ref{usekdalnice}.

\begin{figure}[h]%
\centering
\includegraphics[width=1\textwidth]{images/usekdalnice.png}%
\caption[Simulovanı úsek dálnice -- Praskı okruh km 22--14]{Simulovanı úsek dálnice -- Praskı okruh km 22--14, Zdroj: \cite{Google}}%
\label{usekdalnice}%
\end{figure}

Grafickı podklad byl naimportován z~OSM dle obrázku \ref{usekdalnice} - viz pøíloha \ref{chap:netSUMO}, nicménì po pøevedení do formátu SUMO nìkteré úseky nejsou zobrazeny pro simulaci úplnì pøesnì. Z~dùvodu nepøesnosti pøevodu infrastruktury mezi OSM a SUMO je u~mıtné brány 201 o~jeden jízdní pruh více ne ve skuteènosti.

Nejprve jsem provedl kontrolu dat z~mıtnıch bran. Bohuel touto kontrolou bylo zjištìno, e brána 157 (viz obrázky \ref{b157_28} a \ref{b157_07}) a brána 145 (viz obrázky \ref{b145_28} a \ref{b145_07}) obsahují nekvalitní data. Obrázek znázoròuje èasovou osu, kde na ose $x$ je èas (poèítán po minutách) a na ose $y$ je vynášen poèet vozidel. Problém u~brány 145 není na první pohled vidìt, nicménì pokud se podíváme na intenzitu provozu na bránì 170 (viz obrázky \ref{b170_28} a \ref{b170_07}), vidíme, e je o více jak~50\,\% vyšší ne u~brány 157, co je zjevnı nesmysl.

\begin{figure}%
 \centering
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0170_20121028.pdf}
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0170_20121007.pdf}%
	\end{minipage}		
	\\
	\begin{minipage}[c]{7cm}
		\caption{Brána 0170, 28.10.2012}
		\label{b170_28}%
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\caption{Brána 0170, 7.10.2012}%
		\label{b170_07}
	\end{minipage}			
\end{figure}


\begin{figure}%
 \centering
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0157_20121028.pdf}
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0157_20121007.pdf}%
	\end{minipage}		
	\\
	\begin{minipage}[c]{7cm}
		\caption{Brána 0157, 28.10.2012}
		\label{b157_28}%
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\caption{Brána 0157, 7.10.2012}%
		\label{b157_07}
	\end{minipage}			
\end{figure}

\begin{figure}%
 \centering
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0145_20121028.pdf}
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0145_20121007.pdf}%
	\end{minipage}		
	\\
	\begin{minipage}[c]{7cm}
		\caption{Brána 0145, 28.10.2012}
		\label{b145_28}%
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\caption{Brána 0145, 7.10.2012}%
		\label{b145_07}
	\end{minipage}			
\end{figure}

Zamìøíme se proto hlavnì na úsek mezi branami 218 a 170, kterı je naštìstí pro zkoumání modelù plnì postaèující. Je velmi dùleité data zkontrolovat ještì pøedtím, ne mají bıt pouity pro simulaci, aby se nehledala chyba nìkde, kde nakonec vùbec není.

Postupnì nasimulujeme tento úsek Gippsovım, Kraussovım, IDM a Wiedemannovım modelem. Tyto modely zaèneme kalibrovat tak, e vezmeme hodnoty doporuèené pro simulaci autory a dále je budeme zpøesòovat. Kalibrované modely poté porovnáme s reálnımi daty z mıtnıch bran.

Jako kritérium pro validní model pouijeme vzorec GEH uvedenı v~podkapitole \ref{sec:GEH}. Máme toti k~dispozici data z~detektorù ($c$) a nasimulovaná data pomocí jednotlivıch modelù ($m$) z~rovnice \eqref{eq:GEH}. Intenzity poèítáme jako souèet poètu vozidel za hodinu pro reálná i nasimulovaná data.

Èas vjezdu vozidel byl vdy generován z~exponenciálního rozdìlení, kde parametr rozdìlení byl poèet vozidel v~danou minutu.

V~programu SUMO je implementován vlastní pøedjídìcí model \uv{DK2008}, kterı je primárnì naprogramován pro Kraussùv model. Nicménì i ostatní modely dávaly uspokojivé vısledky, proto nebylo nutné se tímto modelem pøímo zabıvat.

Ve všech obrázcích je zobrazena intenzita provozu v~kadém pruhu a dále také souèet všech intenzit. Pruh 0 odpovídá pruhu nejvíce napravo pøi víceproudé dálnici a kadı další má vdy o~jednièku vyšší hodnotu. Pruh 2 tedy odpovídá pruhu nejvíce vlevo na tøíproudé dálnici.

Generovány byly dva typy rychlostí, preferovaná a pøi vjezdu do oblasti. Preferovaná rychlost byla vdy generována z~normálního rozdìlení se støední hodnotou 36,11$\,\text{ms}^{-1}$\footnote{to odpovídá rychlosti 130 $\,\text{kmh}^{-1}$} bez ohledu na rychlosti na mıtné bránì. Naopak rychlosti vozidel pøi vjezdu do oblasti byly generovány z~náhodného rozdìlení se støední hodnotou rovné hodnotì prùmìrné rychlosti na mıtné bránì.

Nìkteré parametry modelù èi vozidel jsou pro všechny modely stejná, konkrétnì
\begin{itemize}
	\item reakèní èas $T_n = 1\,\text{s}$,
	\item délka vozidla $l = 4{,}5\,\text{m}$,
	\item bezpeènostní odstup (minimální mezera mezi vozidly) $s = 2\,\text{m}$.
\end{itemize}

Pro vyzkoušení funkènosti simulací a správné kalibrace modelù byl jako první den zvolen státní svátek 28.10.2012.

Pokud se jedná o~samotné simulace, tato kapitola bude rozdìlena na simulace podle jednotlivıch modelù. Nejprve budou uvedeny rozdíly mezi teorií (kapitola \ref{chap:predIDM}) a implementací daného modelu, dále budou následovat hodnoty parametrù a poté vısledky samotné simulace s~informacemi o~hodnotách GEH. 

Rozdíly mezi definicí a implementací modelù jsou vìtšinou zpùsobeny samotnım simulaèním nástrojem èi velkım mnostvím parametrù. SUMO umoòuje jednoduše zjistit pouze rychlost prvního vozidla a odstup mezi aktuálním a prvním vozidlem, kdeto v~modelech mùe bıt tato vzdálenost skryta v~urèitém èlenu rovnice.

\section{Gippsùv model}

\subsection{Rozdíly oproti teorii}

Gippsùv model je naimplementován stejnì, jak udává rovnice \eqref{eq:gipps}. Jediná drobná zmìna nastává u~vıpoètu èlenu $\left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right]$, kde není moné získat parametr $s_{\nm1}$. Proto jsem upravil tento èlen jako souèet vzdálenosti mezi vozidly (pøedek aktuálního vozidla a zadek vedoucího vozidla) a k~ní jsem pøièetl minimální bezpeènostní odstup.

\subsection{Nastavení parametrù a simulace}

Nejprve jsme nechali parametry stejné jako u~Kraussova modelu, nicménì to nevedlo k~úspìchu. Podstatná byla informace z~\cite{Brackstone}, kde bylo øeèeno pokusit se nastavit hodnoty \uv{reálnì}, co v~tomto pøípadì pøineslo úspìch a po dalším zpøesnìní GEH nepøesáhlo nikde hodnotu 5. Simulaèní krok zùstal na vıchozí hodnotì 1\,s.

Hodnoty parametrù tedy byly následující:
\begin{itemize}
	\item zrychlení $a = 1,5\,\text{ms}^{-1}$
	\item decelerace $b = 5\,\text{ms}^{-1}$
\end{itemize}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp218Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Brána 0218, 28.10.2012}
\label{gipps218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp201Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Brána 0201, 28.10.2012}
\label{gipps201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp187Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Brána 0187, 28.10.2012}
\label{gipps187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp170Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Brána 0170, 28.12.2012}
\label{gipps170}
\end{figure}

\subsection{Simulace}

Na levé stranì je vykreslena èasová øada dle detektoru a na pravé èasová øada nasimulovaná Gippsovım modelem. Na obrázcích \ref{gipps218}a) a \ref{gipps218}b) je pøímo vidìt urèitá nepøesnost vjezdu vozidel pøi vysokıch intenzitách. To je zpùsobeno podmínkou SUMO pro vjezd do oblasti. Mohli bychom napø. zvıšit decelaraci k~pøesnìní tohoto rozdílu, ovšem tím bychom sníili reálnost simulace. Na dalších mıtnıch branách (napø. obrázky \ref{gipps201}a) a \ref{gipps201}b) tento jev pøetrvává, co je oèekávatelné.

Koeficient GEH má nejvyšší hodnotu v~dobì mezi 15. a 16. hodinou - viz tabulka \ref{GEHGipps}, nicménì hodnota nedosahuje ani 4, èím se dá konstatovat, e model dává uspokojivé vısledky.


\section{Kraussùv model}

\subsection{Rozdíly oproti teorii}

Kraussùv model je pøímo implementován v~SUMO. Byl to vùbec první model, kterı bylo moné v~SUMO vyzkoušet. Nicménì pøes zkoumání se nepodaøilo nalézt pøímou implementaci shodnou s~\eqref{eq:krausssmodel}, konkrétnì jde vıpoèet hodnoty $v_{\safe}$.

\subsection{Nastavení parametrù a simulace}

Simulace bìela s~iteraèním krokem 1\,s.
Vısledné hodnoty nakalibrovaného Kraussova modelu byly:
\begin{itemize}
	\item zrychlení $a = 0,8\, \text{ms}^{-1}$
	\item decelerace $b = 5\, \text{ms}^{-1}$
	\item náhodná vıchylka $\eta$ -- nenastavována dopøedu, generována programem SUMO, hodnota mezi 0 a 1
\end{itemize}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp218krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Brána 0218, 28.10.2012}
\label{krauss218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp201krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Brána 0201, 28.10.2012}
\label{krauss201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp187krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Brána 0187, 28.10.2012}
\label{krauss187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp170krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Brána 0170, 28.10.2012}
\label{krauss170}
\end{figure}

\subsection{Simulace}

Z~obrázkù èasovıch øad je jasnì vidìt, e Kraussùv model dokázal vìrnì kopírovat provoz, a to i v~pomìrnì vysokıch intenzitách. Jak ji bylo øeèeno, velkou vıhodou pro Kraussùv model je implementace do SUMO jako vùbec prvního modelu. Jak bude dále øeèeno, nebyl úplnì nejlepší z~uvedenıch modelù. To je zpùsobeno tím, e intenzita, která je nasimulována Kraussovım modelem, vìtšinou odpovídá skuteèné intenzitì v èase o 2 a 3 minuty posunutém. Skuteèná intenzita u má v~tu chvíli jinou hodnotu. Mùe to bıt dáno generováním vozidel z~exponenciálního rozdìlení èi generováním preferované rychlosti niší, ne aktuálnì byla. Co se tıká maximální hodnoty GEH - viz tabulka \ref{GEHKrauss}, pouze jednou pøekroèila hodnota nepatrnì hodnotu 3, co je velmi dobrı vısledek.


\section{Rozšíøenı Kraussùv model}

\subsection{Rozdíly oproti teorii}

Rozšíøenı Kraussùv model je naimplementován naprosto stejnì jako v~odstavci \ref{exKrauss}, konkrétnì vıpoèet $v_{\safe}$ -- rovnice \eqref{eq:newKrauss}.

\subsection{Nastavení parametrù a simulace}

Všechny parametry byly ponechány stejné jako u~Kraussova modelu. Kraussùv a Rozšíøenı Kraussùv model pracují se stejnımi parametry a zároveò není doporuèeno mìnit jejich hodnoty \cite{Song}.

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp218kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Brána 0218, 28.10.2012}
\label{kraussOrig218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp201kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Brána 0201, 28.10.2012}
\label{kraussOrig201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp187kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Brána 0187, 28.10.2012}
\label{kraussOrig187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp170kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Brána 0170, 28.10.2012}
\label{kraussOrig170}
\end{figure}

\subsection{Simulace}

Ze všech modelù dokázal Rozšíøenı Kraussùv model dosahovat nejvyšších intenzit, a k~60 vozidlùm, a to bez toho, aby byla narušena podmínka bezpeènosti. Bohuel to bylo èasto na úkor sníení pøesnosti modelu, protoe skuteèná intenzita nikdy tuto hodnotu nedosáhla. Je otázkou, èím je takto vysoká intenzita zpùsobena. Mùe to bıt z~dùvodu nahuštìní provozu pøi pøedjídìní dvou vozidel a následnì krátkı silnı provoz, nicménì hlavní prùbìh prùjezdu vozidel je generován v~normì -- viz hodnoty GEH v~tabulce \ref{GEHKraussOrig}.


\section{Intelligent Driver Model}

\subsection{Rozdíly oproti teorii}
\label{sec:IDM-rozdily}

IDM v~SUMO bylo naimplementováno pomìrnì nešastnì. Nebyla tam toti uvedena verze z~teoretické sekce, pouze nìkteré její èásti. IDM byl naprogramován ještì se smyèkou, která mohla zrychlení vozidla poèítat a nìkolikrát. Vısledky neodpovídaly realitì a model i pøi sníeném simulaèním kroku zpùsoboval kolize. Po vyzkoušení tohoto modelu jsem došel k~závìru, e lepší bude naprogramovat IDM pøesnì tak, jak je uveden v~teoretické èásti v~podkapitole \ref{sec:IDM}, a to i z~toho dùvodu, e jsem ho ji zkoušel v~\cite{Vanis}. Pøeprogramována je pouze ta èást modelu, která poèítá interakèní zrychlení. Posléze ji byly vısledky postaèující.


\subsection{Nastavení parametrù a simulace}

Velmi zajímavım poznatkem pro mì byla skuteènost, e kdy jsem si programoval IDM ve svém vlastním programu, vjezd vozidel jsem si øídil jednoduchou podmínkou, aby se mi vozidla nesrazila. Naopak v~SUMO existuje sofistikovaná kontrola vjezdu vozidel a tím pádem jsem musel zvıšit hodnotu decelerace na $b = 5 \text{ms}^{-1}$.

Simulaèní krok jsem tentokrát zvolil 0,1\,s. Byl to kompromis mezi 1\,s nastavenou SUMO a 0,01\,s stanevou v~\cite{Vanis}. Na logaritmické stupnici se tato hodnota nachází pøes v~polovinì. U~IDM se tímto zpùsobem velice zlepšily vısledky, ale také i doba vıpoètu se zvıšila desetinásobnì.  

Parametry modelu byly stanoveny na hodnoty:
\begin{itemize}
	\item zrychlení $a = 0,8 \text{ms}^{-1}$,
	\item decelerace $b = 5 \text{ms}^{-1}$,
	\item exponent zrychlení $\delta = 4$.
\end{itemize}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp218IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Brána 0218, 28.10.2012}
\label{IDM218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp201IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Brána 0201, 28.10.2012}
\label{IDM201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp187IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Brána 0187, 28.10.2012}
\label{IDM187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp170IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Brána 0170, 28.10.2012}
\label{IDM170}
\end{figure}


\subsection{Simulace}

Maximální poèet vozidel, která vjídí do oblasti, se za minutu pøi tìchto parametrech pohybuje okolo 40, viz obrázek \ref{IDM218}. V~další èásti se ji tento poèet zvıšil a k~50 vozidlùm. Je to zaprvé zpùsobeno vjezdovou podmínkou a dle mého názoru pøedjídìcím modelem, kterı není zcela pøizpùsoben IDM modelu. IDM model pracuje ideálnì s~pøedjídìcím modelem MOBIL \cite{Vanis}. Obrázek brány \ref{IDM201} vypadá tak, e souèet pruhù neodpovídá celkovému souètu vozidel. Je to zapøíèinìno nepøesností v~infrastuktuøe (viz vıše), køivka pruhu 1 je skoro totoná s~pruhem 2. Na další bránì, obrázek \ref{IDM187}, jsou vısledky nepøesné primárnì z~dùvodu pøedjídìcího modelu. U~poslední brany, zobrazené na \ref{IDM170}, se intenzity ji zpøesnily. Nicménì stále nastává situace, e intenzita je nejdøíve pomìrnì malá, náhle se velmi zvıší a následnì opìt sníí a to pro oba pruhy. Dle hodnot GEH je IDM v~normì -- viz \ref{GEHIDM}.

\section{Wiedemannùv model}

Wiedemannùv model je v~SUMO naimplementován skoro stejnì jako v~teoretické èásti. Jediná ale zároveò velmi podstatná zmìna nastává pøi zadávání parametrù -- Wiedemannùv model jich má sám o~sobì mnoho. SUMO dokázalo tìchto více jak 10 parametrù modelu shrnout pouze do dvou. Bohuel pouze nastavení tìchto parametrù nepostaèuje k~tomu, abychom byli schopni spustit simulaci na pøijatelné úrovni. Navíc nikde není vysvìtleno, jak tyto dva parametry souvisí s~hranicemi reimù. Proto bohuel vıpoèty køivek AX, SDX atd. nejsou v~SUMU tak pøesné, aby bylo moné simulovat reálnı provoz. Jinak zde existují stejné podmínky pro urèení reimu jako v~obrázku \ref{wiedemann}. Vozidla se bìhem simulace sráí a nepodaøilo se mi pøesnì zjistit, kde se nachází problém. Jednou z~variant je vıpoèet decelerace, protoe Wiedemannùv model ji jako jedinı z~modelu nemá pøímo jako parametr.

Nìkteré hodnoty v~GEH tabulce pøesahují hodnotu 17, co také dokazuje, e v~modelu je nìkde chyba. Pro ilustraci pøikládám na obrázku \ref{Wiedemann170187} poèty vozidel na detektorech u~mıtnıch bran 170, resp. 187, kde je jasnì vidìt, e model selhává, a to bohuel i pøi nízkıch intenzitách.

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{wiedemann/sokp187Wiedemann.pdf} & \includegraphics[width=0.45\textwidth]{wiedemann/sokp170Wiedemann.pdf}  \\
		a) Brána 0187 & b) Brána 0170
	\end{tabular}
		\caption{Wiedemannùv model}
\label{Wiedemann170187}
\end{figure}