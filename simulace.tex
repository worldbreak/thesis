\chapter{Simulace}

V této kapitole se pokusíme zhodnotit nasimulované vısledky z modelù. Simulován bude osmikilometrovı úsek na Praském okruhu mezi 22. a 14. kilometrem. Data z mıtnıch brán máme k dispozici pøiblinì po dvou kilometrech, celkem jich je 6 - viz obrázek \ref{usekdalnice}.

\begin{figure}[h]%
\centering
\includegraphics[width=1\textwidth]{images/usekdalnice.png}%
\caption{Simulovanı úsek dálnice - Praskı okruh km 22 - 14}%
\label{usekdalnice}%
\end{figure}

Grafickı podklad byl naimportován s OSM dle obrázku \ref{usekdalnice} - viz pøíloha \ref{chap:netSUMO}, nicménì po pøevedení do formátu SUMO nìkteré úseky nejsou zobrazeny pro simulaci úplnì pøesnì. Z dùvodu nepøesnosti pøevodu infrastruktury mezi OSM a SUMO je u mıtné brány 201 o jeden jízdní pruh více ne ve skuteènosti.

Nejprve jsme provedli kontrolu dat z mıtnıch bran. Bohuel touto kontrolou bylo zjištìno, e brána 157 (viz obrázky \ref{b157_28} a \ref{b157_07}) a brána 145 (viz obrázky \ref{b145_28} a \ref{b145_07}) obsahují nekvalitní data. Obrázek znázoròuje èasovou osu, kde na ose x je èas (poèítán po minutách) a na ose y je vynášen poèet vozidel. Problém u brány 145 to není na první pohled vidìt, nicménì pokud se podíváme na intenzitu provozu na bránì 170 (viz obrázky \ref{b170_28} a \ref{b170_07}), vidíme, e více jak o 50\% vyšší ne u brány 157, co je nesmysl.

\begin{figure}%
 \centering
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0170_20121028.pdf}
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0170_20121007.pdf}%
	\end{minipage}		
	\\
	\begin{minipage}[c]{7cm}
		\caption{Brána 0170 - 28.10.2012}
		\label{b170_28}%
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\caption{Brána 0170 - 7.10.2012}%
		\label{b170_07}
	\end{minipage}			
\end{figure}


\begin{figure}%
 \centering
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0157_20121028.pdf}
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0157_20121007.pdf}%
	\end{minipage}		
	\\
	\begin{minipage}[c]{7cm}
		\caption{Brána 0157 - 28.10.2012}
		\label{b157_28}%
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\caption{Brána 0157 - 7.10.2012}%
		\label{b157_07}
	\end{minipage}			
\end{figure}

\begin{figure}%
 \centering
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0145_20121028.pdf}
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\includegraphics[width=7cm]{images/brana0145_20121007.pdf}%
	\end{minipage}		
	\\
	\begin{minipage}[c]{7cm}
		\caption{Brána 0145 - 28.10.2012}
		\label{b145_28}%
	\end{minipage}
	\begin{minipage}[c]{7cm}
		\caption{Brána 0145 - 7.10.2012}%
		\label{b145_07}
	\end{minipage}			
\end{figure}

Zamìøíme se proto hlavnì na úsek mezi branami 218 a 170, co je pro zkoumání modelù plnì postaèující. Velmi dùleité je ovšem data zkontrolovat ještì pøedtím, ne mají bıt pouity napø. pro simulaci, aby se nehledala chyba nìkde, kde nakonec vùbec není.

Postupnì nasimulujeme tento úsek Gippsovım, Kraussovım, IDM a Wiedemannovım modelem a poté porovnáme jednotlivé modely. Tyto modely zaèneme kalibrovat tak, e vezmeme hodnoty doporuèené pro simulaci autory a dále je budeme zpøesòovat.

Jako kritérium pro validní model pouijeme formuli GEH \ref{sec:GEH}. Máme toti k dispozici data z detektorù ($c$) a nasimulovaná data pomocí jednotlivıch modelù ($m$) z rovnice \ref{eq:GEH}. Intenzity poèítáme jako souèet poètu vozidel za hodinu pro reálná i nasimulovaná data.

Èas vjezdu vozidel byl vdy generován z exponenciálního rozdìlení, kde parametr rozdìlení byl poèet vozidel v danou minutu.

V programu SUMO je implementován vlastní pøedjídìcí model \uv{DK2008}, kterı je primárnì naprogramován pro Kraussùv model. Nicménì i ostatní modely dávaly uspokojivé vısledky, proto nebylo nutné se tímto modelem pøímo zabıvat. V kadém obrázku je zobrazen provoz v kadém pruhu a potom také souèet všech pruhù

Generovány byly dva typy rychlostí, preferovaná a pøi vjezdu do oblasti. Preferovaná rychlost byla vdy generována z normálního rozdìlení se støední hodnotou 36,11$ms^{-1}$\footnote{to odpovídá rychlosti 130 $kmh^{-1}$} bez ohledu na rychlosti na mıtné bránì. Naopak rychlosti vozidel pøi vjezdu do oblasti byly generovány z náhodného rozdìlení se støední hodnotou rovné hodnotì prùmìrné rychlosti na mıtné bránì.

Nìkteré parametry modelù èi vozidel jsou pro všechny modely stejná, konkrétnì
\begin{itemize}
	\item reakèní èas $T_n = 1 s$,
	\item délka vozidla $l = 4,5 m$,
	\item bezpeènostní odstup (minimální mezera mezi vozidly) $s = 2 m$.
\end{itemize}

Pro vyzkoušení funkènosti simulací a správné kalibrace modelù byl jako první den vzat svátek 28.10.2012.

Pokud se jedná o samotné simulace, tato kapitola bude rozdìlena na simulace podle jednotlivıch modelù. Nejprve budou uvedeny rozdíly mezi teorií (kapitola \ref{chap:predIDM}) a implementací daného modelu, dále budou následovat hodnoty parametrù a poté vısledky samotné simulace s informacemi o hodnotách GEH. 

Rozdíly mezi definicí a implementací modelù jsou vìtšinou zpùsobeny samotnım simulaèním nástrojem èi velkım mnostvím parametrù. SUMO umoòuje jednoduše zjistit pouze rychlost pøedního vozidla a odstup mezi aktuálním a pøedním vozidlemm, kdeto v modelech mùe bıt tato vzdálenost skryta v urèitém èlenu rovnice.

\section{Rozdíly modelù oproti teorii}

\subsection{Wiedemannùv model}

V programu SUMO je standardnì implementován i Wiedemannùv model. Jak je vidìt z odstavce \ref{sec:Wiedemann}, model obsahuje mnoho parametrù, co jsou velmi nároèné vstupní poadavky. Proto v SUMO existuje urèité \uv{zjednodušení}, kde jednotlivé prahy neobsahují parametry, ale jsou ji dopøedu pøednastaveny. Uivatel nastavuje programu pouze dva parametry - security (bezpeènost) a odhad (estimation). Pøes tyto parametry se posléze poèítají jednotlivé prahy. Bohuel se nepodaøilo najít èlánek èi informaci o tom, na základì èeho jsou tyto parametry implementovány.

Tím pádem nebylo moné model vhodnì nakalibrovat a vısledky z tohoto modelu nejsou zdaleka dostaèující.



\section{Gippsùv model}

\subsection{Rozdíly oproti teorii}

Gippsùv model je naimplementován stejnì tak, jak zní rovnice \eqref{eq:gipps}. Jediná drobná zmìna nastává u vıpoètu èlenu $\left[x_{\nm1} (t) - s_{\nm1} - x_\n (t)\right]$, kde není moné získat parametr $s_{\nm1}$. Proto jsme upravili tento èlen jako souèet vzdálenosti mezi vozidly (pøedek aktuálního vozidla a zadek vedoucího vozidla) a k ní jsme pøièetli minimální bezpeènostní odstup.

\subsection{Nastavení parametrù a simulace}

Nejprve jsme nechali parametry stejné jako u Kraussova modelu, nicménì to nevedlo k úspìchu. Podstatné byla informace z \cite{Brackstone}, kde bylo øeèeno pokusit se nastavit hodnoty \uv{reálnì}, co v tomto pøípadì pøineslo úspìch a po dalším zpøesnìní GEH nepøesáhlo nikde hodnotu 5. Simulaèní krok zùstal na vıchozí hodnotì 1s.

Hodnoty parametrù tedy byly následující:
\begin{itemize}
	\item zrychlení $a = 1,5 ms^{-1}$
	\item decelerace $b = 5 ms^{-1}$
\end{itemize}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp218Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Mıtná brána 0218 - 28.10.2012}
\label{gipps218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp201Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Mıtná brána 0201 - 28.10.2012}
\label{gipps201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp187Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Mıtná brána 0187 - 28.10.2012}
\label{gipps187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{gipps/sokp170Gipps.pdf}  \\
		a) Reálná data & b) Gippsùv model
	\end{tabular}
		\caption{Mıtná brána 0170 - 28.12.2012}
\label{gipps170}
\end{figure}

\subsection{Simulace}

Na levé stranì je vykreslena èasová øada dle detektoru a na druhé stranì èasová øada nasimulovaná Gippsovım modelem. Na obrázcích \ref{gipps218}a) a \ref{gipps218}b) je pøímo vidìt urèitá nepøesnost vjezdu vozidel pøi vysokıch intenzitách. To je zpùsobeno podmínkou SUMO pro vjezd do oblasti. Mohli bychom napø. zvıšit decelaraci k pøesnìní tohoto rozdílu, ovšem tím bychom sníili reálnost simulace. Na dalších mıtnıch branách (napø. obrázky \ref{gipps201}a) a \ref{gipps201}b) tento jev pøetrvává, co je oèekávatelné.

Koeficient GEH má nejvyšší hodnotu v dobì mezi 15. a 16. hodinou - viz tabulka \ref{GEHGipps}, nicménì hodnota nedosahuje ani 4, èím se dá konstatovat, a tím pádem model dává uspokojivé vısledky.


\section{Kraussùv model}

\subsection{Rozdíly oproti teorii}

Kraussùv model je údajnì pøímo implementován v SUMO, byl to vùbec první model, kterı byl v SUMO vyzkoušet. Nicménì pøes zkoumání se nepodaøilo nalézt pøímou implementaci shodnou s \eqref{eq:krausssmodel}, konkrétnì vıpoèet hodnoty $v_{\safe}$.

\subsection{Nastavení parametrù a simulace}

Simulace bìela s iteraèním krokem 1s.
Vısledné hodnoty nakalibrovaného Kraussova modelu byly:
\begin{itemize}
	\item zrychlení $a = 0,8 ms^{-1}$
	\item decelerace $b = 5 ms^{-1}$
	\item náhodná vıchylka $\eta$ - nenastavována dopøedu, generována programem SUMO, hodnota mezi 0 a 1
\end{itemize}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp218krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0218 - 28.10.2012}
\label{krauss218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp201krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0201 - 28.10.2012}
\label{krauss201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp187krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0187 - 28.10.2012}
\label{krauss187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{krauss/sokp170krauss.pdf}  \\
		a) Reálná data & b) Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0170 - 28.10.2012}
\label{krauss170}
\end{figure}

\subsection{Simulace}

Z obrázkù èasovıch øad je jasnì vidìl, e Kraussùv model dokázal vìrnì kopírovat provoz a to i v pomìrnì vysokıch intenzitách. Jak ji bylo øeèeno, velkou vıhodou pro Kraussùv model je implementace do SUMO jako vùbec prvního modelu. Co se tıká maximální hodnoty GEH - viz tabulka \ref{GEHKrauss}, pouze jednou pøekroèila hodnota nepatrnì hodnotu 3, co je velmi dobrı vısledek.


\section{Rozšíøenı Kraussùv model}

\subsection{Rozdíly oproti teorii}

Rozšíøenı Kraussùv model je naimplementován naprosto stejnì jako v odstavci \ref{exKrauss}, konkrétnì vıpoèet $v_{\safe}$ - rovnice \eqref{eq:newKrauss}.

\subsection{Nastavení parametrù a simulace}

Všechny parametry byly ponechány stejné jako u Kraussova modelu. Kraussùv a rozšíøenı Kraussùv model pracují se stejnımi parametry a zároveò není doporuèeno mìnit jejich hodnoty. \cite{Song}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp218kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0218 - 28.10.2012}
\label{kraussOrig218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp201kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0201 - 28.10.2012}
\label{kraussOrig201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp187kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0187 - 28.10.2012}
\label{kraussOrig187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{kraussOrig/sokp170kraussOrig.pdf}  \\
		a) Reálná data & b) Rozšíøenı Kraussùv model
	\end{tabular}
		\caption{Mıtná brána 0170 - 28.10.2012}
\label{kraussOrig170}
\end{figure}

\subsection{Simulace}

\rem{doplnit}


\section{Intelligent Driver Model}

\subsection{Rozdíly oproti teorii}
\label{sec:IDM-rozdily}

IDM v SUMO bylo naimplementováno pomìrnì nešastnì. Nebyla zde uvedena verze z teoretické sekce, pouze nìkteré její èásti. IDM zde byl naprogramován ještì se smyèkou, která mohla zrychlení vozidla poèítat a nìkolikrát. Nicménì po vyzkoušení tohoto modelu jsem došel k závìru, e lepší bude naprogramovat IDM pøesnì tak, jak je uveden v teoretické èásti a to i z toho dùvodu, e jsem ho ji zkoušel v \cite{Vanis}. Je tedy pouze pøeprogramována ta èást modelu, která poèítá interakèní zrychlení. Posléze ji byly vısledky postaèující.


\subsection{Nastavení parametrù a simulace}

Velmi zajímavım poznatkem pro mì byla skuteènost, e kdy jsem si programoval IDM ve svém vlastním programu, vjezd vozidel jsem si øídil jednoduchou podmínkou, aby se mi vozidla nesrazila. Naopak v SUMO existuje sofistikovaná kontrola vjezdu vozidel a tím pádem jsem musel zvıšit hodnotu decelerace na $b = 5 ms^{-1}$.

Simulaèní krok jsem tentokrát zvolil 0,1s. U IDM se tímto zpùsobem velice zlepšili vısledky, ale také i doba vıpoètu se zvıšila desetinásobnì. Byl to kompromis mezi 1s nastavenou SUMO a 0,01s, kterou jsem si stanovil v \cite{Vanis}.

Parametry modelu byly stanoveny na hodnoty:
\begin{itemize}
	\item zrychlení $a = 0,8 ms^{-1}$,
	\item decelerace $b = 5 ms^{-1}$,
	\item exponent zrychlení $\delta = 4$.
\end{itemize}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp218orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp218IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Mıtná brána 0218 - 28.10.2012}
\label{IDM218}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp201orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp201IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Mıtná brána 0201 - 28.10.2012}
\label{IDM201}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp187orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp187IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Mıtná brána 0187 - 28.10.2012}
\label{IDM187}
\end{figure}

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{real/sokp170orig.pdf} & \includegraphics[width=0.45\textwidth]{IDM/sokp170IDM.pdf}  \\
		a) Reálná data & b) Intelligent Driver Model
	\end{tabular}
		\caption{Mıtná brána 0170 - 28.10.2012}
\label{IDM170}
\end{figure}


\subsection{Simulace}

\rem{doplnit}

\section{Wiedemannùv model}

Wiedemannùv model je v SUMO naimplementován skoro stejnì jako v teoretické èásti. Jediná, ale zároveò velmi podstatná zmìna nastává pøi zadávání parametrù - Wiedemannùv model jich má sám o sobì mnoho. SUMO dokázalo tìchto více jak 10 parametrù modelu shrnout pouze do dvou parametrù. Bohuel pouze nastavení tìchto parametrù nepostaèuje k tomu, abychom byli schopni spustit simulaci na pøijatelné úrovni. Jinak zde existují stejné podmínky pro urèení oblasti jako v obrázku \ref{wiedemann}. Bohuel vıpoèet køivek AX, SDX atd. nejsou tak pøesné, aby bylo moné simulovat reálnı provoz. Vozidla se bìhem simulace sráí a nepodaøilo se pøesnì zjistit, kde se nachází problém.

Nìkteré hodnoty v GEH tabulce pøesahují hodnotu 17, co také dokazuje, e v modelu je nìkde chyba. Pro ilustraci pøikládám obrázky \ref{Wiedemann170187}a), b) z mıtnıch bran 170, resp. 187, kde je jasnì vidìt, e model selhává a to bohuel i pøi nízkıch intenzitách.

\begin{figure}[h]
	\begin{tabular}{cc}
		\includegraphics[width=0.45\textwidth]{wiedemann/sokp187Wiedemann.pdf} & \includegraphics[width=0.45\textwidth]{wiedemann/sokp170Wiedemann.pdf}  \\
		a) Mıtná brána 0187 & b) Mıtná brána 0170
	\end{tabular}
		\caption{Wiedemannùv model}
\label{Wiedemann170187}
\end{figure}